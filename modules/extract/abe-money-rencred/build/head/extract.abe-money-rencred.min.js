var g_rootrul="https://ib.rencredit.ru",g_baseurl=g_rootrul+"/rencredit.server.portal.app/rest/",g_headers={Accept:"application/json, text/*","Accept-Language":"ru, en","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36",Referer:g_rootrul+"/",Origin:g_rootrul,"X-Requested-With":"XMLHttpRequest"};
function checkAPIResultSimple(b){if(!b)return b;b=getJson(b);if(b.errorResponseMo){var a=b.errorResponseMo.errorMsg;if(a)throw new AnyBalance.Error(a,null,/парол/i.test(a));AnyBalance.trace(JSON.stringify(b));throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}return b}function callAPI(b,a,c){return callAPIEx(b,a,c,null,checkAPIResultSimple)}
function callAPIEx(b,a,c,d,e){b=g_baseurl+b;var h="GET";a&&(b+="?"+createUrlEncodedParams(a));a=c&&c.__paramsAreNotJson;c?h="POST":c="";var f={"X-XSRF-TOKEN":callAPI.data&&callAPI.data.csrfToken};c&&!a&&(f["Content-Type"]="application/json; charset=utf-8");d&&(f=addHeaders(d,f));var g=0;do 0<g&&(AnyBalance.trace("Retrying request: "+g+"/5"),AnyBalance.sleep(1E3)),d=AnyBalance.requestPost(b,"string"==typeof c||a?c:JSON.stringify(c),addHeaders(f),{HTTP_METHOD:h});while(500<=AnyBalance.getLastStatusCode()&&
503>=AnyBalance.getLastStatusCode()&&5>=++g);return(e||getJson)(d)}
function login(){var b=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(b.login,"Введите логин!");checkEmpty(b.password,"Введите пароль!");var a;callAPI("public/version");callAPI.data={};callAPI.data.csrfToken=AnyBalance.getCookie("XSRF-TOKEN");a=callAPI("private/client/info");if(401==AnyBalance.getLastStatusCode()){AnyBalance.trace("Необходим новый логин");a=callAPI("public/auth/login",null,{username:b.login,password:b.password,__paramsAreNotJson:!0});if(a.changePasswordRequired)throw new AnyBalance.Error("Банк требует сменить пароль. Пожалуйста, войдите в интернет банк "+
g_rootrul+" через браузер, смените пароль и введите новый пароль в настройки провайдера",null,!0);a=AnyBalance.retrieveCode("На телефон "+a.clientInfo.maskedPhoneNumber+" выслан код подтверждения для входа в интернет банк. Пожалуйста, введите его",null,{inputType:"number",time:1E3*a.validityOfOtpInSeconds});a=callAPI("private/auth/confirm",null,{confirmationCode:a,__paramsAreNotJson:!0})}if(!a.clientInfo){if(b=a.errorResponseMo&&a.errorResponseMo.errorMsg)throw new AnyBalance.Error(b,null,/парол/i.test(b));
AnyBalance.trace(JSON.stringify(a));throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}a=a.clientInfo;__setLoginSuccessful();return a}
function fetchProductsJson(b){var a={card:{verb:"private/products/cards",name:"карты",firstTimeParams:{forceRequest:"true"}},loan:{verb:"private/products/loans",name:"кредиты"},account:{verb:"private/products/accounts",name:"счета"},deposit:{verb:"private/products/deposits",name:"депозиты"}};if(!a[b])throw new AnyBalance.Error("Неправильный продукт!",null,!0);fetchProductsJson.data||(fetchProductsJson.data={});if(fetchProductsJson.data[b])return fetchProductsJson.data[b];var c=0,d;do 0<c&&(AnyBalance.trace("Пытаемся получить "+
a[b].name+", попытка "+(c+1)+"/10"),AnyBalance.sleep(2E3)),d=callAPI(a[b].verb,0==c?a[b].firstTimeParams:null);while(!d.items&&10>++c);return fetchProductsJson.data[b]=d}
function processCards(b){if(AnyBalance.isAvailable("cards")){var a=fetchProductsJson("card");b.cards=[];for(var c=0;c<a.items.length;++c){var d=a.items[c];if("LOY"!=d.cardType.code){var e={__id:d.id,__name:d.cardType.localizedText+", "+d.cardNumber,num:d.cardNumber};__shouldProcess("cards",e)&&processCard(d,e);b.cards.push(e)}}}}
function processBonus(b){if(AnyBalance.isAvailable("bonus"))for(var a=fetchProductsJson("card"),c=0;c<a.items.length;++c){var d=a.items[c];"LOY"==d.cardType.code&&getParam(d.availableAmount.amount,b,"bonus")}}
function processCard(b,a){getParam(b.availableAmount.amount,a,"cards.balance");getParam(b.availableAmount.currency.code,a,"cards.currency cards.balance cards.minpay cards.limit cards.own cards.blocked cards.cash".split(" "));getParam(b.cardType.localizedText,a,"cards.type");getParam(b.cardType.code,a,"cards.type_code");getParam(b.status.localizedText,a,"cards.status");getParam(b.status.code,a,"cards.status_code");getParam(b.lastPayPeriodMinimumPayment,a,"cards.minpay");getParam(b.creditLimit,a,"cards.limit");
getParam(b.ownFundsAmount,a,"cards.own");getParam(b.blockedAmount,a,"cards.blocked");getParam(b.payPeriodDateOfCompletion,a,"cards.minpaytill",null,null,parseDateISO);getParam(b.accountNumber,a,"cards.accnum");getParam(b.contractNumber,a,"cards.contract");getParam(b.productType,a,"cards.type_product");AnyBalance.isAvailable("cards.transactions")&&processCardsTransactions(b,a)}
function processCredits(b,a){if(AnyBalance.isAvailable("credits"))throw new AnyBalance.Error("Кредиты пока не поддерживаются. Обращайтесь к разработчикам");}
function processCredit(b,a){getParam(b.creditAmount,a,"credits.balance",null,null,parseBalance);getParam(b.currency,a,["credits.currency","credits.balance","credits.minpay","credits.limit"]);getParam(b.name,a,"credits.name");getParam(b.nextInstallmentAmount,a,"credits.minpay",null,null,parseBalance);getParam(b.nextInstallmentDate,a,"credits.minpay_till",null,null,parseDate);getParam(b.openingDate,a,"credits.date_start",null,null,parseDate);getParam(b.status,a,"credits.status");getParam(b.closed_or_not_paid,
a,"credits.close_reason");if(g_url.detailsLoan&&AnyBalance.isAvailable("credits.accnum","credits.date_end","credits.period","credits.pct","credits.limit")){var c=AnyBalance.requestGet(g_url.detailsLoan.replace("{{id}}",b.id),g_headers);getParam(c,a,"credits.accnum",/<div[^>]+class="cell[^>]*>Номер текущего счета[\s\S]*?<div[^>]+class="cell[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);getParam(c,a,"credits.date_end",/<div[^>]+class="cell[^>]*>Дата закрытия кредитного договора[\s\S]*?<div[^>]+class="cell[^>]*>([\s\S]*?)<\/div>/i,
replaceTagsAndSpaces,parseDate);getParam(c,a,"credits.limit",/<div[^>]+class="cell[^>]*>Сумма кредита[\s\S]*?<div[^>]+class="cell[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"credits.period",/<div[^>]+class="cell[^>]*>Срок кредита[\s\S]*?<div[^>]+class="cell[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"credits.pct",/<div[^>]+class="cell[^>]*>Годовая процентная ставка по кредиту[\s\S]*?<div[^>]+class="cell[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,
parseBalance)}AnyBalance.isAvailable("credits.transactions")&&processCreditsTransactions(b,a);AnyBalance.isAvailable("credits.schedule")&&processCreditsSchedule(b,a)}
function processInfo(b,a){a=a.info={};getParam(b.surname+" "+b.name+" "+b.patronymic,a,"info.fio");getParam(b.surname,a,"info.name_last");getParam(b.patronymic,a,"info.name_patronymic");getParam(b.name,a,"info.name");getParam(b.maskedHomeNumber,a,"info.hphone");getParam(b.maskedPhoneNumber,a,"info.mphone");getParam(b.maskedOfficePhone,a,"info.wphone");getParam(b.email,a,"info.email")};
