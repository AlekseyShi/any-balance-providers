var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0"},baseurl="https://ibanking.rosevrobank.ru/ib/site/";
function login(b){AnyBalance.setDefaultCharset("utf-8");checkEmpty(b.login,"Введите логин!");checkEmpty(b.password,"Введите пароль!");var a=AnyBalance.requestGet(baseurl,g_headers);if(!a||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");/logout/i.test(a)?AnyBalance.trace("Уже залогинены, используем существующую сессию"):(getElement(a,/<form[^>]+name="login"[^>]*>/i),a=createFormParams(a,
function(a,c,e,f){return"name"==e?b.login:"password"==e?b.password:"captcha"==e?(a=AnyBalance.requestGet(baseurl+"login/captcha.jpg",addHeaders({Referer:baseurl})),AnyBalance.retrieveCode("Пожалуйста, введите код с картинки",a,{time:18E4})):f}),a=AnyBalance.requestPost(baseurl+"login",a,addHeaders({Referer:baseurl+"login"})));if(!/logout/i.test(a)){var c=getParam(a,null,null,/<div[^>]+id="text2"[^>]*>([\s\S]*?)(?:<p[^>]+class="back"[^>]*>|<\/div>)/i,replaceTagsAndSpaces);if(c)throw new AnyBalance.Error(c,
null,/пароль и код пользователя введены правильно/i.test(c));AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}__setLoginSuccessful();return a}
function processAccounts(b,a){if(AnyBalance.isAvailable("accounts")){b=AnyBalance.requestGet(baseurl+"account/list",g_headers);var c=getElements(b,/<tr[^>]+accountsTable-row[^>]*>/ig);AnyBalance.trace("Найдено счетов: "+c.length);a.accounts=[];for(var d=0;d<c.length;++d){var g=c[d],e=getParam(g,null,null,/accountCode=([^"&]*)/i,replaceHtmlEntities),f=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>)([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),h=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces),k=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),f=f+" "+k+" (*"+h.substr(-4)+")",e={__id:e,__name:f,num:h};__shouldProcess("accounts",e)&&processAccount(g,e);a.accounts.push(e)}}}
function processAccount(b,a){AnyBalance.trace("Обработка счета "+a.__name);getParam(b,a,"accounts.balance",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,["accounts.currency","accounts.balance"],/(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,a,"accounts.blocked",/(?:[\s\S]*?<td[^>]*>){5}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"accounts.available",/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,
parseBalance);var c=getParam(b,null,null,/<a[^>]+href="\/ib\/site\/([^"]*account\/info[^"]*)"/i,replaceHtmlEntities);getParam(c,a,"accounts.type",/accountType=([^"&]*)/i,replaceHtmlEntities);c&&AnyBalance.isAvailable("accounts.pct","accounts.comment","accounts.date_start","accounts.balance_national")&&(b=AnyBalance.requestGet(baseurl+c,g_headers),getParam(b,a,"account.pct",/Годовая процентная ставка:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance),getParam(b,a,"account.comment",
/Примечание:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(b,a,"account.date_start",/Дата открытия счета:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate),getParam(b,a,"account.balance_national",/Остаток в национальной валюте:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance));isAvailable("accounts.transactions")&&processAccountTransactions(b,a)}
function processCards(b,a){if(AnyBalance.isAvailable("cards")){b=AnyBalance.requestGet(baseurl+"card/list",g_headers);var c=getElement(b,/<table[^>]+id="cardListDataTable"[^>]*>/i);if(c){c=getElements(c,[/<tr[^>]*>/ig,/cardListAccountTable|cardListDataTable-row/i]);AnyBalance.trace("Найдено карт и карточных счетов: "+c.length);a.cards=[];for(var d={},g=0;g<c.length;++g){var e=c[g];if(/cardListAccountTable/i.test(e))d={},getParam(e,d,"cards.balance",/Собственные средства:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces,parseBalance),getParam(e,d,"cards.blocked",/Заблокировано:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance),getParam(e,d,"cards.limit",/Кредитный лимит:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance),getParam(e,d,"cards.available",/Доступная сумма:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance),getParam(e,d,"cards.accnum",/Счет[^<]+(\d{20})/i,replaceTagsAndSpaces),getParam(e,d,["cards.currency","cards.balance",
"cards.limit","cards.available"],/\d{20}([^<]*)/i,replaceTagsAndSpaces);else{var f=getParam(e,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),h=getParam(e,null,null,/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),f={__id:f,__name:h+" (*"+f.substr(-4)+")",num:f},f=joinObjects(f,d);__shouldProcess("cards",f)&&processCard(e,f);a.cards.push(f)}}}else/У указанного клиента карт нет/i.test(b)?(a.cards=[],AnyBalance.trace("Нет ни одной карты.")):(AnyBalance.trace(b),
AnyBalance.trace("Не удалось найти таблицу с картами."))}}function processCard(b,a){getParam(b,a,"cards.type",/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,a,"cards.status",/Состояние карты:([^<]*)/i,replaceTagsAndSpaces)}
function processDeposits(b,a){b=AnyBalance.requestGet(baseurl+"contracts/list?confRegParam=Deposit_Reb_Info_Config",g_headers);getParam(b,null,null,/<table[^>]*class="prodlist"[^>]*>[^]*?<\/table>/i)?AnyBalance.trace("Получать депозиты пока не умеем."):/У указанного клиента контрактов нет/i.test(b)?(a.deposits=[],AnyBalance.trace("Нет ни одного депозита.")):(AnyBalance.trace(b),AnyBalance.trace("Не удалось найти таблицу с депозитами."))}function processDeposit(b,a,c){}
function processCredits(b,a){if(AnyBalance.isAvailable("credits")){b=AnyBalance.requestGet(baseurl+"contracts/list?confRegParam=Credits_Info",g_headers);var c=getElement(b,/<table[^>]*id="allContracts"[^>]*>/i);if(c){c=getElements(c,/<tr[^>]*allContracts-row[^>]*>/ig);AnyBalance.trace("Найдено кредитов: "+c.length);a.credits=[];for(var d=0;d<c.length;++d){var g=getParam(c[d],null,null,/'contractCode'\s*:\s*'([^']*)/i,replaceTagsAndSpaces),e=getParam(c[d],null,null,/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)(<script|<\/td>)/i,
replaceTagsAndSpaces),f=getParam(c[d],null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),g={__id:g,__name:f,num:e};__shouldProcess("credits",g)&&processCredit(b,c[d],g);a.credits.push(g)}}else/У указанного клиента контрактов нет/i.test(b)?(a.credits=[],AnyBalance.trace("Нет ни одного кредита.")):(AnyBalance.trace(b),AnyBalance.trace("Не удалось найти таблицу с кредитами."))}}
function processCredit(b,a,c){AnyBalance.trace("Обработка кредита "+c.__id);getParam(a,c,"credits.limit",/(?:[\s\S]*?<td[^>]*>){5}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(a,c,"credits.date_start",/(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate);getParam(a,c,"credits.date_end",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate);getParam(a,c,"credits.currency",/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(a,
c,"credits.pct",/(?:[\s\S]*?<td[^>]*>){7}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);if(AnyBalance.isAvailable("credits.period","credits.penalty","credits.minpaytill","credits.accnum")){var d=getElement(b,/<form[^>]+id="custContractsList"[^>]*>/i);b=createFormParams(d);b.action="showContractDetailedInfo";a=getParam(a,null,null,/setParams\((\{[\s\S]*?\})\)/i,null,getJsonEval);b=joinObjects(a,b);a=getParam(d,null,null,/<form[^>]+action="\/ib\/site\/([^"]*)/i,replaceHtmlEntities);a=AnyBalance.requestPost(baseurl+
a,b,addHeaders({Referer:baseurl}));getParam(a,c,"credits.period",/Срок кредитования в месяцах:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(a,c,"credits.penalty",/Сумма просроченной задолженности:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(a,c,"credits.accnum",/Текущий счет по кредитному договору:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);if(d=getParam(a,null,null,/Дата ежемесячного платежа:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces,parseBalance))b=new Date,a=new Date(b.getFullYear(),b.getMonth(),d,12,59,59),d=new Date(b.getFullYear(),b.getMonth()+1,d,12,59,59),a.getTime()>b.getTime()?getParam(a.getTime(),c,"credits.minpaytill"):getParam(d.getTime(),c,"credits.minpaytill")}}function processInfo(b,a){var c=a.info={};getParam(b,c,"fio",/<span[^>]+id="user"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces)};
