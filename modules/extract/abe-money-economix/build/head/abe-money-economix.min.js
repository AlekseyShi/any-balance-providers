var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.109 Safari/537.36"},baseurl="https://ibank.economiks.ru:2443";
function login(b){AnyBalance.setDefaultCharset("windows-1251");checkEmpty(b.login,"Введите логин!");checkEmpty(b.password,"Введите пароль!");var c=AnyBalance.requestGet(baseurl+"/web_banking/protected/welcome.jsf",g_headers);if(!c||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(c),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");if(/logout/i.test(c))AnyBalance.trace("Уже залогинены, используем существующую сессию");else{getElement(c,
/<form[^>]+name="form:loginForm"[^>]*>/i);var a=createFormParams(c,function(a,c,e,g){return"form:login"==e?b.login:g}),c=AnyBalance.requestPost(baseurl+"/web_banking/login.jsf",a,addHeaders({Referer:baseurl+"/web_banking/login.jsf"})),a=createFormParams(c,function(a,f,e,g){if("j_password"==e||"password_common"==e)return b.password;if("j_username"==e)return b.login;if("captcha"==e){a=getParam(c,null,null,/<img[^>]+id="jcaptcha"[^>]+src="([\s\S]*?)"/i);if(!a)throw new AnyBalance.Error("Не удалось найти капчу. Сайт изменён?");
a=AnyBalance.requestGet(baseurl+a,addHeaders({Referer:baseurl+"/web_banking/login.jsf"}));return AnyBalance.retrieveCode("Пожалуйста, введите код с картинки",a,{time:18E4})}}),c=AnyBalance.requestPost(baseurl+"/web_banking/j_security_check",a,addHeaders({Referer:baseurl+"/web_banking/login.jsf"}))}if(!/logout/i.test(c)){if(a=getParam(c,null,null,[/<div[^>]+iconError"[^>]*>([\s\S]*?)<\/div>/i,/<span[^>]+id="captcha_msg"[^>]*>([\s\S]*?)<\/span>/i],replaceTagsAndSpaces))throw new AnyBalance.Error(a,
null,/(Неверно указаны данные|код с картинки введен неверно)/i.test(a));AnyBalance.trace(c);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}__setLoginSuccessful();return c}
function processAccounts(b,c){if(AnyBalance.isAvailable("accounts")){var a=getElements(b,/<table[^>]+class="tbllist"[^>]*>/ig,null,html_entity_decode);if(a){for(var d=0;d<a.length;d++)if(/счет/i.test(a[d]))var f=getElements(a[d],/<tr[^>]*>/ig);if(f)for(AnyBalance.trace("Найдено счетов: "+(f.length-1)),c.accounts=[],d=1;d<f.length;++d){var a=f[d],e=getParam(a,null,null,/<a[^>]*>(\d+)/i),g=getParam(a,null,null,/<a[^>]*>(\d+)/i),h=getParam(a,null,null,/<a[^>]*>([\s\S]*?)<\/a>/i),e={__id:e,__name:h,num:g};
__shouldProcess("accounts",e)&&processAccount(b,a,e);c.accounts.push(e)}else AnyBalance.trace(b),AnyBalance.trace("Не нашли ни одного счёта."),c.accounts=[]}else AnyBalance.trace(b),AnyBalance.trace("Не удалось найти таблицу со счетами.")}}
function processAccount(b,c,a){AnyBalance.trace("Обработка счета "+a.__name);b=getElement(b,/<div[^>]+class="d-body-content"[^>]*>/i,null,html_entity_decode);b=createFormParams(b,function(a,b,c,d){return d});var d=getParam(c,null,null,/submitForm\('([\s\S]*?)',/i,[/(.+)/i,"$1:_idcl"]);b[d]=getParam(c,null,null,/submitForm\([^,]+,\s*'([\s\S]*?)'/i);b.account_id=getParam(c,null,null,/'account_id',\s*'([\s\S]*?)'/i);b[d]&&b.account_id&&d?(b=AnyBalance.requestPost(baseurl+"/web_banking/protected/welcome.jsf",
b,addHeaders({Referer:baseurl+"/web_banking/protected/welcome.jsf"})),getParam(c,a,"accounts.status",/<span[^>]+class="lowercase"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),getParam(b,a,"accounts.agreement",/id="info"(?:[\s\S]*?<div[^>]*>){3}[^:]*:([\s\S]*?)<\//i,replaceTagsAndSpaces),getParam(b,a,"accounts.date_start",/id="info"(?:[\s\S]*?<div[^>]*>){4}[^:]*:([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate),getParam(b,a,"accounts.balance",/<span[^>]+class="amountBox\s*"[^>]*>([\s\S]*?)<\//i,replaceTagsAndSpaces,
parseBalance),getParam(b,a,["accounts.currency","accounts.balance","accounts.incomingLefts"],/<span[^>]+class="amountBox\s*"[^>]*>([\s\S]*?)<\//i,replaceTagsAndSpaces,parseCurrency),AnyBalance.isAvailable("accounts.transactions")&&processAccountTransactions(b,a)):AnyBalance.trace("Не смогли найти параметр запроса данных по карте "+a.__name)}
function processInfo(b,c){b=AnyBalance.requestGet(baseurl+"/web_banking/protected/service/info.jsf",g_headers);var a=c.info={},d=getElement(b,/<table[^>]+class="tbl"[^>]*>/i,null,html_entity_decode);d?(getParam(d,a,"info.name_last",/Фамилия(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(d,a,"info.name",/Имя(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(d,a,"info.name_patronymic",/Отчество(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(d,a,"info.email",
/e-mail(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(d,a,"info.mphone",/мобильный телефон(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(d,a,"info.hphone",/Домашний телефон(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(d,a,"info.wphone",/Рабочий телефон(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(d,a,"info.inn",/инн(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(d,a,"info.passport",/номер(?:[^>]*>){2}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces),getParam(d,a,"info.raddress",/адрес регистрации(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(d,a,"info.faddress",/адрес фактического(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces)):AnyBalance.trace("Не смогли найти таблицу с пользовательскими данными.")}function processDeposits(b,c){throw new AnyBalance.Error("Обработка депозитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}
function processCredits(b,c){throw new AnyBalance.Error("Обработка кредитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}function processCards(b,c){throw new AnyBalance.Error("Обработка карт пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");};
