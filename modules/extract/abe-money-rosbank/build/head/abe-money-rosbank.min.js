var CRB_M={len_n_fmt:function(c,b,a){return c+" должен быть длиной "+b+" символов и состоять из цифр от 0 до 9"+(a?" и букв A, B, C, D, F":"")},crypt_err:function(c){return"Ошибка шифрования: "+c},invalid:function(c){return c+" задан неверно"},invalid_s:function(c,b){return"Пароль не должен содержать "+c+' и более символов подряд из последовательности "'+b+'"'},SESSION:"Номер сессии",PASS:"Пароль",PASS2:"Введенный пароль не соответствует требованиям к сложности пароля.\r\nЗапрещены Постоянные пароли содержащие:\r\n- 4 и более совпадающих цифр подряд;\r\n- первые 4-е цифры совпадают со следующими 4-мя цифрами;\r\n- первые 4-е цифры совпадают с обратной перестановкой следующих 4-х цифр.\r\nТакже запрещены Постоянные пароли содержащие подстроки \r\nпоследовательностей 0123456789, 9876543210, 1234567890, 0987654321 \r\nи подстроки номера Идентификационной карты клиента.",
PASS_COMPARE:"Введенные пароли не совпадают.",INVALID_PIN2:"Набор введенных символов не может быть ПИН2-кодом",PIN2:"ПИН2",ENC_PIN2:"Зашифрованный ПИН2",INKEY:"АСП",NUMKEY:"Номер АСП",NUMCLIENT:"Идентификационная карта",PASS_D:"Пароль должен содержать не менее одной цифры",PASS_L:"Пароль должен содержать не менее одной маленькой буквы латинского алфавита",PASS_U:"Пароль должен содержать не менее одной большой буквы латинского алфавита",PASS_3:"Пароль не должен содержать 4 и более совпадающих символов подряд",
PASS_C1:"Пароль не должен содержать первые 8 цифр номера идентификационной карты",PASS_C2:"Пароль не должен содержать последние 8 цифр номера идентификационной карты",PASS_4:"Первые 4 символа пароля не должны совпадать с последними 4-мя символами",PASS_4R:"Первые 4 символа пароля не должны совпадать с обратной перестановкой последних 4-х символов"},CRB={encryptBlock:function(c,b){if(!this.data.checkMatches(b,16))return{error:this.msg.len_n_fmt(this.msg.SESSION,16,!1)};if(!this.data.checkMatches(c,
16,!0))return{error:this.msg.len_n_fmt(this.msg.PIN2,16,!0)};try{return{result:this.data.pair(CryptoJS.DES.encrypt(CryptoJS.enc.Hex.parse(b),CryptoJS.enc.Hex.parse(c),{mode:CryptoJS.mode.ECB}).ciphertext).start.toString().toUpperCase()}}catch(a){return{error:this.msg.crypt_err(a.message)}}},encryptBlock2:function(c,b){var a=c.val();if(!this.data.checkMatches(b,16))return c.val(""),{error:this.msg.len_n_fmt(this.msg.SESSION,16,!1)};if(!this.data.checkMatches(a,16,!0))return c.val(""),{error:this.msg.len_n_fmt(this.msg.PIN2,
16,!0)};if(!this.data.checkOdd(a))return c.val(""),{error:this.msg.INVALID_PIN2};try{return{result:this.data.pair(CryptoJS.DES.encrypt(CryptoJS.enc.Hex.parse(b),CryptoJS.enc.Hex.parse(a),{mode:CryptoJS.mode.ECB}).ciphertext).start.toString().toUpperCase()}}catch(d){return c.val(""),{error:this.msg.crypt_err(d.message)}}},pass2bis:function(c,b,a){var d=c.val(),f=b.val();a=a.val();var e="",q="";d!==f&&(e+=this._eol+this.msg.PASS_COMPARE);d.match(new RegExp(/[0-9]+/))||(e+=this._eol+this.msg.PASS_D);
d.match(new RegExp(/[a-z]+/))||(e+=this._eol+this.msg.PASS_L);d.match(new RegExp(/[A-Z]+/))||(e+=this._eol+this.msg.PASS_U);e+=CRB.getLCSLen(d,"01234567890",3,!1);e+=CRB.getLCSLen(d,"09876543210",3,!1);e+=CRB.getLCSLen(d,"abcdefghijklmnopqrstuvwxyz",3,!1);e+=CRB.getLCSLen(d,"zyxwvutsrqponmlkjihgfedcba",3,!1);e+=CRB.getLCSLen(d,"ABCDEFGHIJKLMNOPQRSTUVWXYZ",3,!1);e+=CRB.getLCSLen(d,"ZYXWVUTSRQPONMLKJIHGFEDCBA",3,!1);d.match(new RegExp(/(.)\1{3,}/))&&(e+=this._eol+this.msg.PASS_3);16==a.length&&(d.match(new RegExp("("+
a.substr(0,8)+")","i"))&&(e+=this._eol+this.msg.PASS_C1),d.match(new RegExp("("+a.substr(8,8)+")","i"))&&(e+=this._eol+this.msg.PASS_C2));7<d.length&&(d.substr(0,4)==d.substr(d.length-4,4)&&(e+=this._eol+this.msg.PASS_4),d.substr(0,4)==d.substr(d.length-4,4).split("").reverse().join("")&&(e+=this._eol+this.msg.PASS_4R));if(e)c.val(""),b.val("");else try{q=this.data.pass2hexmd517(d)}catch(l){c.val(""),b.val(""),e+=this._eol+this.msg.crypt_err(l.message)}return{error:e,result:q}},getLCSLen:function(c,
b,a,d){var f="";CRB.lcs(c,b,d).length>a&&(f+=this._eol+this.msg.invalid_s(a+1,b));return f},lcs:function(c,b,a){var d=0,f=c.length;for(lcsi=0;lcsi<c.length;lcsi++){var e=0;for(lcsj=0;lcsj<lcsi+1;lcsj++){var q=new RegExp("(?:.{"+e+"})(.{"+f+"})",a?"i":"");q.test(c);q=new RegExp("("+RegExp.$1+")",a?"i":"");if(q.test(b)){d=1;result=RegExp.$1;break}e++}if(1==d)return result;f--}return result=""},encryptPin2n:function(c,b,a,d){c=c.val();var f=b.val(),e=a.val(),q=d.val(),l="",u="";this.data.checkMatches(f,
16,!0)||(b.val(""),l+=this.msg.len_n_fmt(this.msg.PIN2,16,!0));this.data.checkOdd(f)||(b.val(""),l+=this._eol+this.msg.INVALID_PIN2);this.data.checkMatches(e,8)||(a.val(""),d.val(""),l+=this._eol+this.msg.len_n_fmt(this.msg.PASS,8,!1));e!==q?(a.val(""),d.val(""),l+=this._eol+this.msg.PASS_COMPARE):this.data.CheckPwdBusinessRules(e,c)||(a.val(""),d.val(""),l+=this._eol+this.msg.PASS2);if(!l)try{var m=this.data.doCrypt("encrypt",function(a){return a},f,e),u=(m.start.toString()+m.end.toString()).toUpperCase()}catch(r){b.val(""),
a.val(""),d.val(""),l+=this._eol+this.msg.crypt_err(r.message)}return{error:l,result:u}},encryptPin2:function(c,b){if(!this.data.checkMatches(c,16,!0))return{error:this.msg.len_n_fmt(this.msg.PIN2,16,!0)};if(!this.data.checkOdd(c))return{error:this.msg.invalid(this.msg.PIN2)};if(!this.data.checkMatches(b,8))return{error:this.msg.len_n_fmt(this.msg.PASS,8,!1)};try{var a=this.data.doCrypt("encrypt",function(a){return a},c,b);return{result:(a.start.toString()+a.end.toString()).toUpperCase()}}catch(d){return{error:this.msg.crypt_err(d.message)}}},
decryptPin2:function(c,b,a){if(!this.data.checkMatches(c,32,!0))return{error:this.msg.len_n_fmt(this.msg.ENC_PIN2,32,!0)};if(a&&!this.data.checkMatches(b,8))return{error:this.msg.len_n_fmt(this.msg.PASS,8,!1)};try{return{result:this.data.doCrypt("decrypt",function(a){return{ciphertext:a}},c,b).start.toString().toUpperCase()}}catch(d){return{error:this.msg.crypt_err(d.message)}}},sign:function(c,b,a,d){7!=a.length&&(a=this.data.fillStart(a.trim(),7,"0"));if(!this.data.checkMatches(d.trim(),"1,19",
!1))return{error:this.msg.invalid(this.msg.NUMCLIENT)};d=this.data.fillEnd(d,19," ");if(!this.data.checkMatches(b.trim(),16,!0))return{error:this.msg.invalid(this.msg.INKEY)};var f=this.data.fillStart(String(c).length,4,"0");try{var e=this.data.codePage.winToDos(c),q=CryptoJS.SHA1(CryptoJS.enc.Hex.parse(this.data.arrToHex(this.data.codePage.dosToAs(a+b.toUpperCase()+f).concat(this.data.codePage.dosbToAs(e))))).toString();return{result:(d+a+q+f+this.data.arrToHex(e)).toUpperCase(),digest:q.toUpperCase()}}catch(l){return{error:this.msg.crypt_err(l.message)}}},
data:{salt:function(){return"CCC8D1EEF0EAE8ED"},checkMatches:function(c,b,a){return c&&c.match(new RegExp("^[0-9"+(a?"a-f":"")+"]{"+b+"}$","i"))},fillStart:function(c,b,a){return Array(1+(b-String(c).length)).join(a)+c},fillEnd:function(c,b,a){return c+Array(1+(b-String(c).length)).join(a)},checkOdd:function(c){for(var b=0;b<c.length;b+=2){var a=parseInt("0x"+c.substr(b,2));0>a&&(a=256+a);for(var d=0;0<a;)d^=a%2,a=Math.floor(a/2);if(0==d)return!1}return!0},arrToHex:function(c){for(var b="",a=0;a<
c.length;a++)var d=Number(c[a]).toString(16),b=b+(1==d.length?"0"+d:d);return b},pair:function(c){return{start:CryptoJS.lib.WordArray.create([c.words[0],c.words[1]]),end:4==c.words.length?CryptoJS.lib.WordArray.create([c.words[2],c.words[3]]):null}},genMD5:function(c,b){c=CryptoJS.enc.Hex.parse(c);for(var a=0;a<b;a++)c=CryptoJS.MD5(c);return c},pass2hex:function(c){return CryptoJS.enc.Latin1.parse(CryptoJS.enc.Latin1.parse(c).toString().toUpperCase())},pass2hexmd517:function(c){return this.genMD5(this.pass2hex(c)+
this.salt(),17)},doCrypt:function(c,b,a,d){d=this.pair(this.genMD5(this.pass2hex(d)+this.salt(),17));c=CryptoJS.TripleDES[c](b(CryptoJS.enc.Hex.parse(a)),d.start,{mode:CryptoJS.mode.CBC,iv:d.end});return this.pair(b(c).ciphertext)},CheckPwdBusinessRules:function(c,b){var a=!0;"0123456789".match(new RegExp("("+c+")","i"))?a=!1:"9876543210".match(new RegExp("("+c+")","i"))?a=!1:"1234567890".match(new RegExp("("+c+")","i"))?a=!1:"0987654321".match(new RegExp("("+c+")","i"))?a=!1:b.match(new RegExp("("+
c+")","i"))&&(a=!1);a&&c.match(new RegExp(/(.)\1{3,}/))&&(a=!1);a&&c.match(new RegExp(/(.{4})\1+/))&&(a=!1);a&&c.substr(0,4)==c.substr(4,4).split("").reverse().join("")&&(a=!1);return a},codePage:{dosToAs:function(c){return this.dosbToAs(this.unicodeToWin1251(c))},dosbToAs:function(c){return this.deCode(c,"dosToAs")},winToDos:function(c){return this.deCode(this.unicodeToWin1251(c),"winToDos")},lib:{winToDos:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,
33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,63,255,246,247,63,253,63,63,63,240,63,242,63,63,63,63,244,248,63,63,63,63,63,63,250,241,252,243,
63,63,63,63,245,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239],dosToAs:[0,1,2,3,55,45,46,47,22,5,37,11,12,13,14,15,16,17,18,19,60,30,50,38,24,25,28,39,7,29,30,31,64,79,127,123,91,108,80,125,77,93,92,78,107,96,75,97,240,241,242,243,244,245,246,247,248,249,122,94,76,126,110,111,124,193,194,195,
196,197,198,199,200,201,209,210,211,212,213,214,215,216,217,226,227,228,229,230,231,232,233,74,224,90,95,109,121,129,130,131,132,133,134,135,136,137,145,146,147,148,149,150,151,152,153,162,163,164,165,166,167,168,169,192,106,208,161,63,185,186,237,191,188,189,236,250,203,204,205,206,207,218,219,220,222,223,234,235,190,202,187,254,251,253,87,239,238,252,184,221,119,120,175,141,138,139,174,178,143,144,154,155,156,157,158,159,43,44,9,33,40,27,61,255,66,56,49,52,51,67,70,36,34,23,41,6,32,42,71,73,26,
53,8,57,54,48,58,81,82,83,84,86,89,10,98,101,102,35,21,20,4,104,105,59,170,171,172,173,140,142,128,182,179,181,183,177,176,180,118,160,99,68,100,69,103,72,116,85,112,113,114,115,88,117,62,65],dMap:{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31,32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,
54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,127:127,1027:129,
8225:135,1046:198,8222:132,1047:199,1168:165,1048:200,1113:154,1049:201,1045:197,1050:202,1028:170,160:160,1040:192,1051:203,164:164,166:166,167:167,169:169,171:171,172:172,173:173,174:174,1053:205,176:176,177:177,1114:156,181:181,182:182,183:183,8221:148,187:187,1029:189,1056:208,1057:209,1058:210,8364:136,1112:188,1115:158,1059:211,1060:212,1030:178,1061:213,1062:214,1063:215,1116:157,1064:216,1065:217,1031:175,1066:218,1067:219,1068:220,1069:221,1070:222,1032:163,8226:149,1071:223,1072:224,8482:153,
1073:225,8240:137,1118:162,1074:226,1110:179,8230:133,1075:227,1033:138,1076:228,1077:229,8211:150,1078:230,1119:159,1079:231,1042:194,1080:232,1034:140,1025:168,1081:233,1082:234,8212:151,1083:235,1169:180,1084:236,1052:204,1085:237,1035:142,1086:238,1087:239,1088:240,1089:241,1090:242,1036:141,1041:193,1091:243,1092:244,8224:134,1093:245,8470:185,1094:246,1054:206,1095:247,1096:248,8249:139,1097:249,1098:250,1044:196,1099:251,1111:191,1055:207,1100:252,1038:161,8220:147,1101:253,8250:155,1102:254,
8216:145,1103:255,1043:195,1105:184,1039:143,1026:128,1106:144,8218:130,1107:131,8217:146,1108:186,1109:190}},deCode:function(c,b){for(var a=[],d=this.lib[b],f=c instanceof Array?function(a,c){return a[c]}:function(a,c){return a.charCodeAt(c)},e=0;e<c.length;e++){var q=f(c,e);a[e]=d[q]}return a},unicodeToWin1251:function(c){for(var b=[],a=0;a<c.length;a++){var d=c.charCodeAt(a);if(!(d in this.lib.dMap))throw"Character "+c.charAt(a)+" isn't supported by win1251!";b.push(String.fromCharCode(this.lib.dMap[d]))}return b.join("")}}},
msg:{len_n_fmt:CRB_M.len_n_fmt,crypt_err:CRB_M.crypt_err,invalid:CRB_M.invalid,invalid_s:CRB_M.invalid_s,SESSION:CRB_M.SESSION,PASS:CRB_M.PASS,PASS2:CRB_M.PASS2,PASS_COMPARE:CRB_M.PASS_COMPARE,INVALID_PIN2:CRB_M.INVALID_PIN2,PIN2:CRB_M.PIN2,ENC_PIN2:CRB_M.ENC_PIN2,INKEY:CRB_M.INKEY,NUMKEY:CRB_M.NUMKEY,NUMCLIENT:CRB_M.NUMCLIENT,PASS_U:CRB_M.PASS_U,PASS_L:CRB_M.PASS_L,PASS_D:CRB_M.PASS_D,PASS_3:CRB_M.PASS_3,PASS_C1:CRB_M.PASS_C1,PASS_C2:CRB_M.PASS_C2,PASS_4:CRB_M.PASS_4,PASS_4R:CRB_M.PASS_4R},_eol:"\r\n"};var CryptoJS=CryptoJS||function(c,b){var a={},d=a.lib={},f=d.Base=function(){function a(){}return{extend:function(c){a.prototype=this;var b=new a;c&&b.mixIn(c);b.$super=this;return b},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.$super.extend(this)}}}(),e=d.WordArray=f.extend({init:function(a,c){a=
this.words=a||[];this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||l).stringify(this)},concat:function(a){var c=this.words,b=a.words,g=this.sigBytes;a=a.sigBytes;this.clamp();if(g%4)for(var k=0;k<a;k++)c[g+k>>>2]|=(b[k>>>2]>>>24-k%4*8&255)<<24-(g+k)%4*8;else if(65535<b.length)for(k=0;k<a;k+=4)c[g+k>>>2]=b[k>>>2];else c.push.apply(c,b);this.sigBytes+=a;return this},clamp:function(){var a=this.words,b=this.sigBytes;a[b>>>2]&=4294967295<<32-b%4*8;a.length=c.ceil(b/4)},clone:function(){var a=
f.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var b=[],d=0;d<a;d+=4)b.push(4294967296*c.random()|0);return e.create(b,a)}}),q=a.enc={},l=q.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],g=0;g<a;g++){var k=c[g>>>2]>>>24-g%4*8&255;b.push((k>>>4).toString(16));b.push((k&15).toString(16))}return b.join("")},parse:function(a){for(var c=a.length,b=[],g=0;g<c;g+=2)b[g>>>3]|=parseInt(a.substr(g,2),16)<<24-g%8*4;return e.create(b,c/2)}},u=q.Latin1={stringify:function(a){var c=
a.words;a=a.sigBytes;for(var b=[],g=0;g<a;g++)b.push(String.fromCharCode(c[g>>>2]>>>24-g%4*8&255));return b.join("")},parse:function(a){for(var c=a.length,b=[],g=0;g<c;g++)b[g>>>2]|=(a.charCodeAt(g)&255)<<24-g%4*8;return e.create(b,c)}},m=q.Utf8={stringify:function(a){try{return decodeURIComponent(escape(u.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return u.parse(unescape(encodeURIComponent(a)))}},r=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=
e.create();this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=m.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var b=this._data,d=b.words,g=b.sigBytes,k=this.blockSize,v=g/(4*k),v=a?c.ceil(v):c.max((v|0)-this._minBufferSize,0);a=v*k;g=c.min(4*a,g);if(a){for(var r=0;r<a;r+=k)this._doProcessBlock(d,r);r=d.splice(0,a);b.sigBytes-=g}return e.create(r,g)},clone:function(){var a=f.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0});d.Hasher=
r.extend({init:function(){this.reset()},reset:function(){r.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);this._doFinalize();return this._hash},clone:function(){var a=r.clone.call(this);a._hash=this._hash.clone();return a},blockSize:16,_createHelper:function(a){return function(b,c){return a.create(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return t.HMAC.create(a,c).finalize(b)}}});var t=
a.algo={};return a}(Math);
CryptoJS.lib.Cipher||function(c){var b=CryptoJS,a=b.lib,d=a.Base,f=a.WordArray,e=a.BufferedBlockAlgorithm,q=b.enc.Base64,l=b.algo.EvpKDF,u=a.Cipher=e.extend({cfg:d.extend(),createEncryptor:function(a,b){return this.create(this._ENC_XFORM_MODE,a,b)},createDecryptor:function(a,b){return this.create(this._DEC_XFORM_MODE,a,b)},init:function(a,b,c){this.cfg=this.cfg.extend(c);this._xformMode=a;this._key=b;this.reset()},reset:function(){e.reset.call(this);this._doReset()},process:function(a){this._append(a);return this._process()},
finalize:function(a){a&&this._append(a);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){return function(a){return{encrypt:function(b,c,d){return("string"==typeof c?n:p).encrypt(a,b,c,d)},decrypt:function(b,c,d){return("string"==typeof c?n:p).decrypt(a,b,c,d)}}}}()});a.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var m=b.mode={},r=a.BlockCipherMode=d.extend({createEncryptor:function(a,b){return this.Encryptor.create(a,
b)},createDecryptor:function(a,b){return this.Decryptor.create(a,b)},init:function(a,b){this._cipher=a;this._iv=b}}),m=m.CBC=function(){function a(b,g,d){var k=this._iv;k?this._iv=c:k=this._prevBlock;for(var h=0;h<d;h++)b[g+h]^=k[h]}var b=r.extend();b.Encryptor=b.extend({processBlock:function(b,c){var d=this._cipher,k=d.blockSize;a.call(this,b,c,k);d.encryptBlock(b,c);this._prevBlock=b.slice(c,c+k)}});b.Decryptor=b.extend({processBlock:function(b,c){var d=this._cipher,k=d.blockSize,h=b.slice(c,c+
k);d.decryptBlock(b,c);a.call(this,b,c,k);this._prevBlock=h}});return b}(),t=(b.pad={}).Pkcs7={pad:function(a,b){for(var c=4*b,c=c-a.sigBytes%c,d=c<<24|c<<16|c<<8|c,h=[],e=0;e<c;e+=4)h.push(d);c=f.create(h,c);a.concat(c)},unpad:function(a){a.sigBytes-=a.words[a.sigBytes-1>>>2]&255}};a.BlockCipher=u.extend({cfg:u.cfg.extend({mode:m,padding:t}),reset:function(){u.reset.call(this);var a=this.cfg,b=a.iv,a=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var c=a.createEncryptor;else c=a.createDecryptor,
this._minBufferSize=1;this._mode=c.call(a,this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),a.unpad(b);return b},blockSize:4});var h=a.CipherParams=d.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}}),m=(b.format={}).OpenSSL={stringify:function(a){var b=
a.ciphertext;a=a.salt;b=(a?f.create([1398893684,1701076831]).concat(a).concat(b):b).toString(q);return b.replace(/(.{64})/g,"$1\n")},parse:function(a){a=q.parse(a);var b=a.words;if(1398893684==b[0]&&1701076831==b[1]){var c=f.create(b.slice(2,4));b.splice(0,4);a.sigBytes-=16}return h.create({ciphertext:a,salt:c})}},p=a.SerializableCipher=d.extend({cfg:d.extend({format:m}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var e=a.createEncryptor(c,d);b=e.finalize(b);e=e.cfg;return h.create({ciphertext:b,
key:c,iv:e.iv,algorithm:a,mode:e.mode,padding:e.padding,blockSize:a.blockSize,formatter:d.format})},decrypt:function(a,b,c,d){d=this.cfg.extend(d);b=this._parse(b,d.format);return a.createDecryptor(c,d).finalize(b.ciphertext)},_parse:function(a,b){return"string"==typeof a?b.parse(a):a}}),b=(b.kdf={}).OpenSSL={compute:function(a,b,c,d){d||(d=f.random(8));a=l.create({keySize:b+c}).compute(a,d);c=f.create(a.words.slice(b),4*c);a.sigBytes=4*b;return h.create({key:a,iv:c,salt:d})}},n=a.PasswordBasedCipher=
p.extend({cfg:p.cfg.extend({kdf:b}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);c=d.kdf.compute(c,a.keySize,a.ivSize);d.iv=c.iv;a=p.encrypt.call(this,a,b,c.key,d);a.mixIn(c);return a},decrypt:function(a,b,c,d){d=this.cfg.extend(d);b=this._parse(b,d.format);c=d.kdf.compute(c,a.keySize,a.ivSize,b.salt);d.iv=c.iv;return p.decrypt.call(this,a,b,c.key,d)}})}();
CryptoJS.mode.ECB=function(){var c=CryptoJS.lib.BlockCipherMode.extend();c.Encryptor=c.extend({processBlock:function(b,a){this._cipher.encryptBlock(b,a)}});c.Decryptor=c.extend({processBlock:function(b,a){this._cipher.decryptBlock(b,a)}});return c}();
(function(c){function b(a,b,c,d,e,g,k){a=a+(b&c|~b&d)+e+k;return(a<<g|a>>>32-g)+b}function a(a,b,c,d,e,g,k){a=a+(b&d|c&~d)+e+k;return(a<<g|a>>>32-g)+b}function d(a,b,c,d,e,g,k){a=a+(b^c^d)+e+k;return(a<<g|a>>>32-g)+b}function f(a,b,c,d,e,g,k){a=a+(c^(b|~d))+e+k;return(a<<g|a>>>32-g)+b}var e=CryptoJS,q=e.lib,l=q.WordArray,q=q.Hasher,u=e.algo,m=[];(function(){for(var a=0;64>a;a++)m[a]=4294967296*c.abs(c.sin(a+1))|0})();u=u.MD5=q.extend({_doReset:function(){this._hash=l.create([1732584193,4023233417,
2562383102,271733878])},_doProcessBlock:function(c,e){for(var h=0;16>h;h++){var p=e+h,n=c[p];c[p]=(n<<8|n>>>24)&16711935|(n<<24|n>>>8)&4278255360}for(var p=this._hash.words,n=p[0],g=p[1],k=p[2],l=p[3],h=0;64>h;h+=4)16>h?(n=b(n,g,k,l,c[e+h],7,m[h]),l=b(l,n,g,k,c[e+h+1],12,m[h+1]),k=b(k,l,n,g,c[e+h+2],17,m[h+2]),g=b(g,k,l,n,c[e+h+3],22,m[h+3])):32>h?(n=a(n,g,k,l,c[e+(h+1)%16],5,m[h]),l=a(l,n,g,k,c[e+(h+6)%16],9,m[h+1]),k=a(k,l,n,g,c[e+(h+11)%16],14,m[h+2]),g=a(g,k,l,n,c[e+h%16],20,m[h+3])):48>h?(n=
d(n,g,k,l,c[e+(3*h+5)%16],4,m[h]),l=d(l,n,g,k,c[e+(3*h+8)%16],11,m[h+1]),k=d(k,l,n,g,c[e+(3*h+11)%16],16,m[h+2]),g=d(g,k,l,n,c[e+(3*h+14)%16],23,m[h+3])):(n=f(n,g,k,l,c[e+3*h%16],6,m[h]),l=f(l,n,g,k,c[e+(3*h+7)%16],10,m[h+1]),k=f(k,l,n,g,c[e+(3*h+14)%16],15,m[h+2]),g=f(g,k,l,n,c[e+(3*h+5)%16],21,m[h+3]));p[0]=p[0]+n|0;p[1]=p[1]+g|0;p[2]=p[2]+k|0;p[3]=p[3]+l|0},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;b[d>>>5]|=128<<24-d%32;b[(d+64>>>9<<4)+14]=(c<<8|c>>>
24)&16711935|(c<<24|c>>>8)&4278255360;a.sigBytes=4*(b.length+1);this._process();a=this._hash.words;for(b=0;4>b;b++)c=a[b],a[b]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360}});e.MD5=q._createHelper(u);e.HmacMD5=q._createHmacHelper(u)})(Math);
(function(){var c=CryptoJS,b=c.lib,a=b.WordArray,b=b.Hasher,d=[],f=c.algo.SHA1=b.extend({_doReset:function(){this._hash=a.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,f=c[0],m=c[1],r=c[2],t=c[3],h=c[4],p=0;80>p;p++){if(16>p)d[p]=a[b+p]|0;else{var n=d[p-3]^d[p-8]^d[p-14]^d[p-16];d[p]=n<<1|n>>>31}n=(f<<5|f>>>27)+h+d[p];n=20>p?n+((m&r|~m&t)+1518500249):40>p?n+((m^r^t)+1859775393):60>p?n+((m&r|m&t|r&t)-1894007588):n+((m^r^t)-
899497514);h=t;t=r;r=m<<30|m>>>2;m=f;f=n}c[0]=c[0]+f|0;c[1]=c[1]+m|0;c[2]=c[2]+r|0;c[3]=c[3]+t|0;c[4]=c[4]+h|0},_doFinalize:function(){var a=this._data,c=a.words,b=8*this._nDataBytes,d=8*a.sigBytes;c[d>>>5]|=128<<24-d%32;c[(d+64>>>9<<4)+15]=b;a.sigBytes=4*c.length;this._process()}});c.SHA1=b._createHelper(f);c.HmacSHA1=b._createHmacHelper(f)})();
(function(){function c(a,c){var b=(this._lBlock>>>a^this._rBlock)&c;this._rBlock^=b;this._lBlock^=b<<a}function b(a,c){var b=(this._rBlock>>>a^this._lBlock)&c;this._lBlock^=b;this._rBlock^=b<<a}var a=CryptoJS,d=a.lib,f=d.WordArray,d=d.BlockCipher,e=a.algo,q=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],l=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,
55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],u=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],m=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,
2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,
1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,
75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,
276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,
14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,
17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,
98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,
1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,
10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,
83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,
2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,
16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,
496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,
2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,
2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],r=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],t=e.DES=d.extend({_doReset:function(){for(var a=this._key.words,c=[],b=0;56>b;b++){var d=q[b]-1;c[b]=a[d>>>5]>>>31-d%32&1}a=this._subKeys=[];for(d=0;16>d;d++){for(var e=a[d]=[],f=u[d],b=0;24>b;b++)e[b/6|0]|=c[(l[b]-1+f)%28]<<31-b%6,e[4+(b/6|0)]|=c[28+(l[b+24]-1+f)%28]<<31-b%6;e[0]=e[0]<<1|e[0]>>>31;for(b=1;7>b;b++)e[b]>>>=
4*(b-1)+3;e[7]=e[7]<<5|e[7]>>>27}c=this._invSubKeys=[];for(b=0;16>b;b++)c[b]=a[15-b]},encryptBlock:function(a,b){this._doCryptBlock(a,b,this._subKeys)},decryptBlock:function(a,b){this._doCryptBlock(a,b,this._invSubKeys)},_doCryptBlock:function(a,d,e){this._lBlock=a[d];this._rBlock=a[d+1];c.call(this,4,252645135);c.call(this,16,65535);b.call(this,2,858993459);b.call(this,8,16711935);c.call(this,1,1431655765);for(var g=0;16>g;g++){for(var f=e[g],l=this._lBlock,q=this._rBlock,u=0,t=0;8>t;t++)u|=m[t][((q^
f[t])&r[t])>>>0];this._lBlock=q;this._rBlock=l^u}e=this._lBlock;this._lBlock=this._rBlock;this._rBlock=e;c.call(this,1,1431655765);b.call(this,8,16711935);b.call(this,2,858993459);c.call(this,16,65535);c.call(this,4,252645135);a[d]=this._lBlock;a[d+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});a.DES=d._createHelper(t);e=e.TripleDES=d.extend({_doReset:function(){var a=this._key.words;this._des1=t.createEncryptor(f.create(a.slice(0,2)));this._des2=t.createEncryptor(f.create(a.slice(2,4)));this._des3=
t.createEncryptor(f.create(a.slice(4,6)))},encryptBlock:function(a,b){this._des1.encryptBlock(a,b);this._des2.decryptBlock(a,b);this._des3.encryptBlock(a,b)},decryptBlock:function(a,b){this._des3.decryptBlock(a,b);this._des2.encryptBlock(a,b);this._des1.decryptBlock(a,b)},keySize:6,ivSize:2,blockSize:2});a.TripleDES=d._createHelper(e)})();var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive",Origin:"https://ibank.rosbank.ru",Referer:"https://ibank.rosbank.ru/","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/35.0.1916.114 Safari/537.36"},g_baseurl="https://ibank.rosbank.ru/";
function getViewState(c){return getParam(c,null,null,/name="__VIEWSTATE".*?value="([^"]*)"/)||getParam(c,null,null,/__VIEWSTATE\|([^\|]*)/i)}function getEventValidation(c){return getParam(c,null,null,/name="__EVENTVALIDATION".*?value="([^"]*)"/)||getParam(c,null,null,/__EVENTVALIDATION\|([^\|]*)/i)}
function login(){var c=AnyBalance.getPreferences(),b=AnyBalance.requestGet(g_baseurl,g_headers);if(/Logout.aspx/i.test(b))AnyBalance.trace("Найдена активная сессия. Используем её.");else{var b=AnyBalance.requestPost(g_baseurl+"Login.aspx",{ctl00$MainScriptManager:"ctl00$MainContentPlaceHolder$TabsUpdatePanel|ctl00$MainContentPlaceHolder$CardButton",__LASTFOCUS:"",__EVENTTARGET:"",__EVENTARGUMENT:"",__VIEWSTATE:getViewState(b),__EVENTVALIDATION:getEventValidation(b),ctl00$MainContentPlaceHolder$pin1:"",
ctl00$MainContentPlaceHolder$TransCod:"",ctl00$MainContentPlaceHolder$pin2enc:"",ctl00$MainContentPlaceHolder$Signature:"",ctl00$MainContentPlaceHolder$CardNumTextBox:c.login,__ASYNCPOST:"true",ctl00$MainContentPlaceHolder$CardButton:"%D0%9F%D1%80%D0%BE%D0%B4%D0%BE%D0%BB%D0%B6%D0%B8%D1%82%D1%8C"},addHeaders({"X-MicrosoftAjax":"Delta=true"})),a=getParam(b,null,null,/class="pin2enc" value="(.*)"/);if(!a)throw new AnyBalance.Error("Вы ввели неправильный логин! Введите последние восемь цифр идентификационной карты или ваш логин в интернет банк Росбанк.",
null,!0);var d=getParam(b,null,null,/class="TransCod" value="(.*)"/),f=c.password,e="",e=CRB.decryptPin2(a,f);if(e.result)if(e=CRB.encryptBlock(e.result,d),e.result)e=e.result;else throw new AnyBalance.Error(e.error);else throw new AnyBalance.Error(e.error);b=AnyBalance.requestPost(g_baseurl+"Login.aspx",{ctl00$MainScriptManager:"ctl00$MainContentPlaceHolder$TabsUpdatePanel|ctl00$MainContentPlaceHolder$Pwd1Button",ctl00$MainContentPlaceHolder$pin1:"50845000"+c.login.replace(" ",""),ctl00$MainContentPlaceHolder$TransCod:d,
ctl00$MainContentPlaceHolder$pin2enc:a,ctl00$MainContentPlaceHolder$Signature:e,ctl00$MainContentPlaceHolder$pin3:f,__LASTFOCUS:"",__EVENTTARGET:"",__EVENTARGUMENT:"",__VIEWSTATE:getViewState(b),__EVENTVALIDATION:getEventValidation(b),__ASYNCPOST:"true",ctl00$MainContentPlaceHolder$Pwd1Button:"%D0%9F%D1%80%D0%BE%D0%B4%D0%BE%D0%BB%D0%B6%D0%B8%D1%82%D1%8C"},addHeaders({"X-MicrosoftAjax":"Delta=true"}));if(!/Logout.aspx/i.test(b)&&!/pageRedirect/i.test(b)){if(c=getParam(b,null,null,/<div[^>]+class="loginError"[^>]*>([\s\S]*?)<\/div>/i,
replaceTagsAndSpaces))throw new AnyBalance.Error(c,null,/не найден/i.test(c));if(c=getParam(b,null,null,/<div[^>]+class="fulltab"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(c,null,/некорректного ввода пароля/i.test(c));if(c=getParam(b,null,null,/<div[^>]+id="[^"]*CardDesc11Panel"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(c,null,/Пароль введен неверно/i.test(c));AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось войти в интернет-банк. Сайт изменен?");
}__setLoginSuccessful()}return b}
function processAccounts(c){if(AnyBalance.isAvailable("accounts")){var b=AnyBalance.requestGet(g_baseurl+"Accounts.aspx",g_headers),a=getElement(b,/<table[^>]+id="[^"]*_AccTable"[^>]*>/i);if(a)for(c.accounts=[],b=getElements(a,[/<tr[^>]*>/ig,/<td/i]),AnyBalance.trace("Нашли "+b.length+" счетов"),a=0;a<b.length;++a){var d=b[a],f=getParam(d,null,null,/([\s\S]*?<\/td>){2}/i,replaceTagsAndSpaces),e=getParam(d,null,null,/([\s\S]*?<\/td>){1}/i,replaceTagsAndSpaces),f={__id:f,__name:e+" "+f.substr(-4),num:f};
__shouldProcess("accounts",f)&&processAccount(d,f);c.accounts.push(f)}else AnyBalance.trace(b),AnyBalance.trace("Не удалось получить таблицу счетов")}}
function processAccount(c,b){AnyBalance.trace("Обработка счета "+b.__name);getParam(c,b,"accounts.balance",/([\s\S]*?<\/td>){3}/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"accounts.currency",/([\s\S]*?<\/td>){3}/i,replaceTagsAndSpaces,parseCurrency);if(AnyBalance.isAvailable("accounts.num","accounts.type","accounts.owner")){var a=getParam(c,null,null,/"(AccountInfo.aspx\?id=[^"]*)/i,replaceHtmlEntities),a=AnyBalance.requestGet(g_baseurl+a,g_headers);getParam(a,b,"accounts.num",/Номер счёта:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces);getParam(a,b,"accounts.type",/Тип счёта:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(a,b,"accounts.owner",/Наименование счёта:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces)}AnyBalance.isAvailable("accounts.transactions")&&processTransactions(c,b)}
function processTransactions(c,b){AnyBalance.trace("Получаем транзакции для "+b.__name);var a=getParam(c,null,null,/"(StatementsAuto.aspx\?id=[^"]*)/i,replaceHtmlEntities),a=AnyBalance.requestGet(g_baseurl+a,g_headers),d=getElement(a,/<div[^>]+entryCont[^>]*>/i,[/<tr[^>]*>\s*<th[^>]*>[^<]*<\/th>\s*<\/tr>/i,""]);d?(a={date:{re:/Дата/i,result_func:parseDateSilent},descr:{re:/Содержание/i,result_func:null},sum:{re:/Сумма/i,result_func:parseBalanceSilent}},b.transactions=[],processTable(d,b.transactions,
"accounts.transactions.",a)):(d=getElement(a,/<div[^>]+errorBlock[^>]*>/i,replaceTagsAndSpaces))?AnyBalance.trace(d):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти таблицу транзакций"))}
function processCards(c){if(AnyBalance.isAvailable("cards")){var b=AnyBalance.requestGet(g_baseurl+"Accounts.aspx",g_headers),a=getElement(b,/<table[^>]+id="[^"]*_CardsTable"[^>]*>/i);if(a)for(c.cards=[],b=getElements(a,[/<tr[^>]*>/ig,/<td/i]),AnyBalance.trace("Нашли "+b.length+" карт"),a=0;a<b.length;++a){var d=b[a],f=getParam(d,null,null,/([\s\S]*?<\/td>){2}/i,replaceTagsAndSpaces),e=getParam(d,null,null,/([\s\S]*?<\/td>){1}/i,replaceTagsAndSpaces),f={__id:f,__name:e+" "+f.substr(-4),num:f};__shouldProcess("cards",
f)&&processCard(d,f);c.cards.push(f)}else AnyBalance.trace(b),AnyBalance.trace("Не удалось получить таблицу карт")}}
function processCard(c,b){AnyBalance.trace("Обработка карты "+b.__name);getParam(c,b,"cards.till",/([\s\S]*?<\/td>){4}/i,replaceTagsAndSpaces,parseDate);getParam(c,b,"cards.status",/([\s\S]*?<\/td>){3}/i,replaceTagsAndSpaces);if(AnyBalance.isAvailable("cards.balance","cards.currency","cards.num","cards.accnum")){var a=getParam(c,null,null,/"(CardInfo.aspx\?id=[^"]*)/i,replaceHtmlEntities),a=AnyBalance.requestGet(g_baseurl+a,g_headers);getParam(a,b,"cards.balance",/Текущий доступный остаток:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.currency",/Валюта счета:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);AnyBalance.getPreferences().full_num&&getParam(a,b,"cards.num",/Номер карты[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(a,b,"cards.accnum",/Номер счета:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,[replaceTagsAndSpaces,/\(.*/i,""])}AnyBalance.isAvailable("cards.transactions")&&processTransactions(c,b)}
function processInfo(c){if(AnyBalance.isAvailable("info")){c=c.info={};var b=AnyBalance.requestGet(g_baseurl+"Profile.aspx",g_headers);getParam(b,c,"info.fio",/<h3\s+class="two-cols"\s*>\s*<span[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(b,c,"info.email",/<a[^>]+EmailHyperLink[^>]*>([\s\S]*?)<\/a>/i,replaceTagsAndSpaces);getParam(b,c,"info.notify",/Уведомления:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);AnyBalance.isAvailable("info.phone")&&(b=AnyBalance.requestGet(g_baseurl+
"ProfileChangeParams.aspx",g_headers),getParam(b,c,"info.phone",/<input[^>]+PhoneTextBox[^>]+value="([^"]*)/i,replaceTagsAndSpaces))}}
function fetchCredit(c,b){var a=AnyBalance.getPreferences();/<a[^>]+href="Loans.aspx"/.test(b)&&(b=AnyBalance.requestGet(c+"Loans.aspx"));var d=getParam(b,null,null,new RegExp("(<tr[^>]*id=[\"']?par_(?:[\\s\\S](?!<tr))*"+(a.contract||"td")+"[\\s\\S]*?</tr>)","i"));if(!d)throw new AnyBalance.Error("Не удаётся найти "+(a.contract?"кредит №"+a.contract:"ни одного кредита"));a={success:!0};getParam(d,a,"balance",/(?:[\s\S]*?<td[^>]*>){13}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(d,
a,"accnum",/(?:[\s\S]*?<td[^>]*>){5}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(d,a,"__tariff",/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(d,a,"currency",/(?:[\s\S]*?<td[^>]*>){10}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(d,a,"accname",/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(d,a,"till",/(?:[\s\S]*?<td[^>]*>){8}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate);getParam(d,a,"payTill",/(?:[\s\S]*?<td[^>]*>){11}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces,parseDate);getParam(d,a,"payNext",/(?:[\s\S]*?<td[^>]*>){12}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"fio",/<span[^>]+id="ctl00_FIOLabel"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(d,a,"limit",/(?:[\s\S]*?<td[^>]*>){9}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);AnyBalance.requestGet(c+"Logout.aspx",g_headers2);AnyBalance.setResult(a)}
function processDeposits(c){if(AnyBalance.isAvailable("deposits")){var b=AnyBalance.requestGet(g_baseurl+"Deposits.aspx",g_headers),b=b.replace(/\x3c!--[\s\S]*?--\x3e/g,""),a=getElements(b,/<div[^>]+class="entryCont"[^>]*>/i);if(0==a.length)AnyBalance.trace(b),AnyBalance.trace("Не удалось получить вклады");else for(c.deposits=[],AnyBalance.trace("Нашли "+a.length+" вкладов"),b=0;b<a.length;++b){var d=a[b],f=getParam(d,null,null,/([\s\S]*?<\/td>){3}/i,replaceTagsAndSpaces),e=getParam(d,null,null,/<td[^>]*>([\s\S]*?<\/td>){1}/i,
replaceTagsAndSpaces),f={__id:f,__name:e+" "+f.substr(-4),num:f};__shouldProcess("deposits",f)&&processDeposit(d,f);c.deposits.push(f)}}}function parseBool(c){return/Да/i.test(c)}
function processDeposit(c,b){AnyBalance.trace("Обработка вклада "+b.__name);getParam(c,b,"deposits.balance",/([\s\S]*?<\/td>){4}/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"deposits.currency",/([\s\S]*?<\/td>){4}/i,replaceTagsAndSpaces,parseCurrency);getParam(c,b,"deposits.agreement",/([\s\S]*?<\/td>){2}/i,replaceTagsAndSpaces);if(AnyBalance.isAvailable("deposits.num","deposits.num1","deposits.num2","deposits.type","deposits.period","deposits.owner","deposits.date_start","deposits.date_end",
"deposits.balance_start","deposits.balance_min","deposits.min_topup","deposits.pct","deposits.pct_sum","deposits.pct_period","deposits.pct_period2","deposits.pct_next_till","deposits.pct_next","deposits.topup")){var a=getParam(c,null,null,/"(DepositInfo.aspx\?id=[^"]*)/i,replaceHtmlEntities),a=AnyBalance.requestGet(g_baseurl+a,g_headers);getParam(a,b,"deposits.num",/Номер\s+счёта\s+вклада:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(a,b,"deposits.num1",/Номер\s+счёта-синонима:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces);getParam(a,b,"deposits.type",/Вид\s+вклада:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(a,b,"deposits.period",/Срок\s+вклада:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(a,b,"deposits.owner",/ФИО\s+клиента:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(a,b,"deposits.num2",/Счёт\s+погашения\s+суммы\s+вклада\s+и\s+%:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(a,b,"deposits.date_start",/Дата\s+открытия\s+вклада:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces,parseDate);getParam(a,b,"deposits.date_end",/Дата\s+окончания\s+срока\s+вклада:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate);getParam(a,b,"deposits.balance_start",/Начальная\s+сумма\s+вклада:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"deposits.balance_min",/Минимальная\s+сумма\s+вклада:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"deposits.min_topup",/Минимальная\s+сумма\s+пополнения:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces,parseBalance);getParam(a,b,"deposits.pct",/Текущая\s+ставка\s+%:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"deposits.pct_sum",/Выплаченные\s+%:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"deposits.pct_period",/Частота\s+выплаты\s+процентов\s+на\s+счёт\s+по\s+вкладу:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(a,b,"deposits.pct_period2",/Частота\s+перечисления\s+процентов\s+на\s+счёт\s+погашения:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces);getParam(a,b,"deposits.pct_next_till",/Дата\s+очередного\s+начисления\s+процентов:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate);getParam(a,b,"deposits.pct_next",/Сумма\s+процентов\s+к\s+очередной\s+выплате:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"deposits.topup",/Пополнение:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBool)}AnyBalance.isAvailable("deposits.transactions")&&processTransactions(c,
b)}function processCredits(c){AnyBalance.isAvailable("deposits")&&(c=AnyBalance.requestGet(g_baseurl+"Loans.aspx",g_headers),(c=getElement(c,/<div[^>]+id="[^"]*_ErrorPanel"/i,replaceTagsAndSpaces))&&AnyBalance.trace("У вас нет кредитов: "+c))};
