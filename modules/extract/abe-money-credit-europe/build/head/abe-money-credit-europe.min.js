var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Origin:"https://online.crediteurope.ru",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0"},baseurl="https://online.crediteurope.ru/FWFIB/";
function getSessionId(b){return getParam(b,null,null,/<input[^>]+name="session_id"[^>]*value\s*=\s*['"]?([^'">\s]*)/i,replaceHtmlEntities)}
function login(){var b=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(b.login,"Введите логин!");checkEmpty(b.password,"Введите пароль!");var c=AnyBalance.requestGet(baseurl+"allmenuitems.jsp?session_lang=ru",g_headers),a=getSessionId(c);if(a)AnyBalance.trace("Используем текущую сессию...");else{AnyBalance.trace("Сессия не установлена. Будем заходить заново");c=AnyBalance.requestGet(baseurl+"loginNewNV.jsp",g_headers);a=getElement(c,/<form[^>]+class="login"[^>]*>/i);if(!a)throw AnyBalance.trace(c),
new AnyBalance.Error("Не удалось найти форму входа. Сайт изменен?");AnyBalance.setCookie(getParam(baseurl,null,null,/:\/\/([^\/]*)/),"see3","1");c=createFormParams(a,function(a,c,d,g){return"USERNAME"==d?b.login:"PASSWORD"==d?b.password:g});c=AnyBalance.requestPost(baseurl+"loginNewNV.jsp",c,addHeaders({Referer:AnyBalance.getLastUrl()}));a=getElement(c,/<form[^>]+loginSMS[^>]*>/i);if(!a){if(a=getElement(c,/<td[^>]*color:\s*red[^>]*>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(a,null,/Пароль/i.test(a));
AnyBalance.trace(c);throw new AnyBalance.Error("Не удаётся войти в интернет банк. Сайт изменен?");}c=createFormParams(a,function(a,b,c,d){return"SMSPASS"==c?AnyBalance.retrieveCode("Пожалуйста, введите код из СМС, пришедшего вам не телефон, для входа в интернет-банк"):d});c=AnyBalance.requestPost(baseurl+"loginSMS.jsp",c,addHeaders({Referer:AnyBalance.getLastUrl()}));a=getElement(c,/<form[^>]+FWFServlet[^>]*>/i);if(!a){if(a=getElement(c,/<td[^>]*color:\s*red[^>]*>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(a);
AnyBalance.trace(c);throw new AnyBalance.Error("Не удаётся войти в интернет банк после ввода СМС-кода. Сайт изменен?");}c=createFormParams(a,null,!0);c=AnyBalance.requestPost(baseurl+"FWFServlet",c,addHeaders({Referer:AnyBalance.getLastUrl()}));if(!getParam(c,null,null,/<frame[^>]+name="mainframe"[^>]*src="([^"]*)/i,replaceHtmlEntities))throw AnyBalance.trace(c),new AnyBalance.Error("Не удалось войти в интернет банк на главную страницу. Сайт изменен?");AnyBalance.trace("Загружаем фреймсет...");for(var a=
sumParam(c,null,null,/<frame[^>]+src="([^"]*)/ig,replaceHtmlEntities),d=0;d<a.length;++d)c=AnyBalance.requestGet(joinUrl(baseurl,a[d]),addHeaders({Referer:baseurl+"FWFServlet"}));AnyBalance.trace("Получаем всё меню...");c=AnyBalance.requestGet(baseurl+"allmenuitems.jsp?session_lang=ru",g_headers);a=getSessionId(c);if(!a)throw AnyBalance.trace(c),new AnyBalance.Error("Не удалось получить меню после входа в интернет-банк. Сайт изменен?");}__setLoginSuccessful();return c}
function getMenuPage(b,c){var a=getParam(b,null,null,new RegExp("evaluate\\s*\\([^)]*"+c+"[^)]*"));if(!a)throw AnyBalance.trace(b),new AnyBalance.Error("Не удаётся найти ссылку на меню "+c+". Сайт изменен?");var d=getSessionId(b),e=getParam(a,null,null,/\(\s*'([^']*)/),f=getParam(a,null,null,/\((?:\s*[^,)]*,){2}\s*['"]?([^'",]*)/),a=getParam(a,null,null,/\((?:\s*[^,)]*,){3}\s*['"]?([^'",]*)/),d=getSessionId(b);return b=AnyBalance.requestPost(baseurl+"FWFServlet",{callType:"mpageCall",page:e,rights:"",
path:f,menuID:a,allItems:"true",session_id:d,lang:"ru"},addHeaders({Referer:baseurl+"allmenuitems.jsp?session_lang=ru"}))}function processInfo(b,c){if(AnyBalance.isAvailable("info")){var a=getSessionId(b);b=AnyBalance.requestPost(baseurl+"FWFServlet",{callType:"mpageCall",session_id:a,lang:"ru",USERGROUP:"br",TOPFRAME_CALLING:"true",page:""},addHeaders({Referer:baseurl+"FWFServlet"}));a=c.info={};getParam(b,a,"info.fio",/Здравствуйте,([^!<]*)/i,replaceTagsAndSpaces)}}
function processAccounts(b,c){if(AnyBalance.isAvailable("accounts")){b=getMenuPage(b,"Текущие счета");var a=getElement(b,/<tbody[^>]+scrollContent[^>]*>/i);a||(AnyBalance.trace(b),AnyBalance.trace("Не найдена таблица счетов"));c.accounts=[];a=getElements(a,/<tr[^>]*>/ig);if(a.length){AnyBalance.trace("Найдено счетов: "+a.length);for(var d=0;d<a.length;++d){var e=a[d],f=getParam(e,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),h=getParam(e,null,null,/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces)+" "+f.substr(-4),f={__id:f,__name:h,num:f};__shouldProcess("accounts",f)&&(b=processAccount(b,e,f));c.accounts.push(f)}}else AnyBalance.trace(b),AnyBalance.trace("Счета не найдены")}}
function createPropTable(b){var c=getElements(b,/<span[^>]+class\s*=\s*["']?base\b[^>]*>/ig);b=[];for(var a=0;a<c.length;++a){var d=c[a],e=/font-weight:bold|left:10px|left:355px/i.test(d)?-1:0,f=getParam(d,null,null,/top:\s*(\d+)px/i,replaceHtmlEntities,parseBalanceSilent),h=getParam(d,null,null,/left:\s*(\d+)px/i,replaceHtmlEntities,parseBalanceSilent),d=getParam(d,null,null,null,replaceTagsAndSpaces);b.push({title:e,vert:f,hor:h,text:d})}b.sort(function(a,b){var c=a.vert-b.vert;if(c||(c=a.hor-b.hor))return c});
for(var c=[],g,a=0;a<b.length;++a)d=b[a],d.title?(g&&c.push(g),g={title:d.text,text:""}):g&&(g.text+=(g.text?" ":"")+d.text);g&&c.push(g);return c}function performAction(b,c,a){var d=getElements(a,[/<(?:a|button)[^>]*populateForm[^>]*>/ig,b])[0];if(!d)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти действие: "+b.source);return performActionByString(d,c,a)}
function performActionByString(b,c,a){var d=getParam(b,null,null,/populateForm\w*\s*\(\s*'?([^',]*)/,replaceHtmlEntities);"this"==d&&(d=getParam(b,null,null,/name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities));var e=getParam(b,null,null,/populateForm\w*\s*\([^,)]*\s*,\s*'?([^',]*)/,replaceHtmlEntities);if(Array.isArray(c)){b="";for(var f=0;f<c.length;++f)b+=c[f].join(":")+"|";c=b}else if("object"==typeof c){b="";for(f in c)b+=f+":"+c[f]+"|";c=b}a=getElement(a,/<form[^>]+name="generic"[^>]*>/i);a=
createFormParams(a,function(a,b,f,l){return"params"==f?c:"triggeredbean"==f?d:"event"==f?e:l});return a=AnyBalance.requestPost(baseurl+"FWFServlet",a,addHeaders({Referer:baseurl+"FWFServlet"}))}
function processAccount(b,c,a){AnyBalance.trace("Обработка счета "+a.__name);getParam(c,a,"accounts.balance",/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(c,a,["accounts.currency","accounts.balance"],/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseCurrency);getParam(c,a,"accounts.name",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);if(AnyBalance.isAvailable("accounts.owner","accounts.date_start","accounts.transactions")){var d=
getParam(c,null,null,/<input[^>]+type=\s*['"]?radio[^>]*/i);c=getParam(d,null,null,/value\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities);c=getParam(d,null,null,/name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities)+":"+c+"|FRE$TabPage:0|0:true|";b=performActionByString(d,c,b);b=performAction(/Выписка по счету/i,c,b);for(var d=createPropTable(b),e=0;e<d.length;++e){var f=d[e];/Имя владельца/i.test(f.title)?getParam(f.text,a,"accounts.owner"):/Дата открытия счета/i.test(f.title)&&getParam(f.text,a,"accounts.date_start",
null,null,parseDate)}AnyBalance.isAvailable("accounts.transactions")&&(b=processAccountTransactions(b,a));b=performAction(/geri.gif/i,c,b)}return b}
function processCards(b,c){if(AnyBalance.isAvailable("cards")){b=getMenuPage(b,"Информация по Карте");var a=getElements(b,[/<div[^>]+class=['"]?base\b[^>]*>/ig,/Все карты, включая заблокированные/i])[0],d={FRE$TabPage:0};if(a){AnyBalance.trace("Включаем все карты.");var e=getParam(a,null,null,/name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities);d[e]="true";b=performActionByString(a,d,b)}a=getElements(b,[/<select[^>]*>/ig,/\d{6}\*{6}\d{4}/i])[0];a||(AnyBalance.trace(b),AnyBalance.trace("Не найдена таблица карт"));
e=getParam(a,null,null,/<select[^>]+name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities);c.cards=[];var f=sumParam(a,null,null,/<option[^>]*>[\s\S]*?(?:<\/option>|(?=<option)|(?=<\/select>))/ig);if(f.length){AnyBalance.trace("Найдено карт: "+(f.length-1));for(var h=0;h<f.length;++h){var g=f[h],k=getParam(g,null,null,/\bvalue="([^"]*)/i,replaceHtmlEntities);if(k){var l=getParam(g,null,null,/\d{6}\*{6}\d{4}/i,replaceTagsAndSpaces),g=getParam(g,null,null,null,replaceTagsAndSpaces),k={__id:k,__name:g,num:l};
__shouldProcess("cards",k)&&(d[e]=h,b=processCard(b,a,d,k));c.cards.push(k)}}}else AnyBalance.trace(b),AnyBalance.trace("Карты не найдены")}}
function processCard(b,c,a,d){AnyBalance.trace("Обработка карты "+d.__name);b=performActionByString(c,a,b);c=createPropTable(b);for(a=0;a<c.length;++a){var e=c[a];/Тип карты/i.test(e.title)&&getParam(e.text,d,"cards.type");/Тип продукта/i.test(e.title)?getParam(e.text,d,"cards.product_type"):/Имя владельца/i.test(e.title)?getParam(e.text,d,"cards.holder"):/Номер счета/i.test(e.title)?getParam(e.text,d,"cards.accnum"):/Валюта/i.test(e.title)?getParam(e.text,d,["cards.currency","cards.balance"]):/Статус Карты/i.test(e.title)?
getParam(e.text,d,"cards.status"):/действительна до/i.test(e.title)?getParam(e.text,d,"cards.till",null,null,parseDate):/Кредитный лимит/i.test(e.title)?getParam(e.text,d,"cards.limit",null,null,parseBalance):/Лимит для снятия наличными/i.test(e.title)?getParam(e.text,d,"cards.limit_cash",null,null,parseBalance):/Сумма доступных средств$/i.test(e.title)?(getParam(e.text,d,"cards.balance",null,null,parseBalance),getParam(e.text,d,"cards.available",null,null,parseBalance)):/Сумма доступных средств для снятия наличными/i.test(e.title)?
getParam(e.text,d,"cards.available_cash",null,null,parseBalance):/Собственные средства/i.test(e.title)?getParam(e.text,d,"cards.own",null,null,parseBalance):/Задолженность по выписке/i.test(e.title)?getParam(e.text,d,"cards.debt_previous",null,null,parseBalance):/Предварительный расчет задолженности на текущую дату/i.test(e.title)?getParam(e.text,d,"cards.debt",null,null,parseBalance):/Сумма накопленных баллов/i.test(e.title)&&getParam(e.text,d,"cards.bonus",null,null,parseBalance)}return b}
function processDeposits(b,c){AnyBalance.isAvailable("deposits")}
function processCredits(b,c){if(AnyBalance.isAvailable("credits")){b=getMenuPage(b,"Кредиты");var a=getElement(b,/<tbody[^>]+scrollContent[^>]*>/i);a||(AnyBalance.trace(b),AnyBalance.trace("Не найдена таблица кредитов"));c.credits=[];a=getElements(a,/<tr[^>]*>/ig);if(a.length){AnyBalance.trace("Найдено кредитов: "+a.length);for(var d=0;d<a.length;++d){var e=a[d],f=getParam(e,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),h=getParam(e,null,null,/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces)+" "+f.substr(-4),f={__id:f,__name:h,num:f};__shouldProcess("credits",f)&&(b=processCredit(b,e,f));c.credits.push(f)}}else AnyBalance.trace(b),AnyBalance.trace("Кредиты не найдены")}}function parseBool(b){return!/нет/i.test(b)}
function processCredit(b,c,a){AnyBalance.trace("Обработка кредита "+a.__name);getParam(c,a,"credits.balance",/(?:[\s\S]*?<td[^>]*>){14}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(c,a,["credits.currency","credits.balance"],/(?:[\s\S]*?<td[^>]*>){14}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseCurrency);getParam(c,a,"credits.limit",/(?:[\s\S]*?<td[^>]*>){12}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"credits.till",/(?:[\s\S]*?<td[^>]*>){10}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces,parseDate);getParam(c,a,"credits.date_start",/(?:[\s\S]*?<td[^>]*>){8}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate);getParam(c,a,"credits.status",/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(c,a,"credits.name",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);if(AnyBalance.isAvailable("credits.type","credits.accnum","credits.minpay_till","credits.shoud_pay_full","credits_pay_full","credits.schedule")){var d=getParam(c,null,null,
/<input[^>]+type=\s*['"]?radio[^>]*/i);c=getParam(d,null,null,/value\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities);c=getParam(d,null,null,/name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities)+":"+c+"|FRE$TabPage:0|0:true|";b=performActionByString(d,c,b);b=performAction(/Информация по кредиту/i,c,b);for(var d=createPropTable(b),e=0;e<d.length;++e){var f=d[e];/Тип Кредита/i.test(f.title)?getParam(f.text,a,"credits.type"):/^Счет$/i.test(f.title)?getParam(f.text,a,"credits.accnum"):/Дата очередного платежа/i.test(f.title)?
getParam(f.text,a,"credits.minpay_till",null,null,parseDate):/К досрочному погашению/i.test(f.title)?getParam(f.text,a,"credits.should_pay_full",null,null,parseBool):/Сумма полного досрочного погашения/i.test(f.title)&&getParam(f.text,a,"credits.pay_full",null,null,parseBalance)}AnyBalance.isAvailable("credits.schedule")&&(b=processCreditSchedule(b,a));b=performAction(/Назад/i,c,b)}return b};
