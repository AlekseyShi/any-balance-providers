var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Origin:"https://online.crediteurope.ru",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0"},baseurl="https://online.crediteurope.ru/FWFIB/";
function getSessionId(c){return getParam(c,null,null,/<input[^>]+name="session_id"[^>]*value\s*=\s*['"]?([^'">\s]*)/i,replaceHtmlEntities)}
function login(){var c=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(c.login,"Введите логин!");checkEmpty(c.password,"Введите пароль!");var b=AnyBalance.requestGet(baseurl+"allmenuitems.jsp?session_lang=ru",g_headers),a=getSessionId(b);if(a)AnyBalance.trace("Используем текущую сессию...");else{AnyBalance.trace("Сессия не установлена. Будем заходить заново");b=AnyBalance.requestGet(baseurl+"loginNewNV.jsp",g_headers);a=getElement(b,/<form[^>]+class="login"[^>]*>/i);if(!a)throw AnyBalance.trace(b),
new AnyBalance.Error("Не удалось найти форму входа. Сайт изменен?");AnyBalance.setCookie(getParam(baseurl,null,null,/:\/\/([^\/]*)/),"see3","1");b=createFormParams(a,function(a,b,d,g){return"USERNAME"==d?c.login:"PASSWORD"==d?c.password:g});b=AnyBalance.requestPost(baseurl+"loginNewNV.jsp",b,addHeaders({Referer:AnyBalance.getLastUrl()}));a=getElement(b,/<form[^>]+loginSMS[^>]*>/i);if(!a){if(a=getElement(b,/<td[^>]*color:\s*red[^>]*>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(a,null,/Пароль/i.test(a));
AnyBalance.trace(b);throw new AnyBalance.Error("Не удаётся войти в интернет банк. Сайт изменен?");}b=createFormParams(a,function(a,c,b,d){return"SMSPASS"==b?AnyBalance.retrieveCode("Пожалуйста, введите код из СМС, пришедшего вам не телефон, для входа в интернет-банк"):d});b=AnyBalance.requestPost(baseurl+"loginSMS.jsp",b,addHeaders({Referer:AnyBalance.getLastUrl()}));a=getElement(b,/<form[^>]+FWFServlet[^>]*>/i);if(!a){if(a=getElement(b,/<td[^>]*color:\s*red[^>]*>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(a);
AnyBalance.trace(b);throw new AnyBalance.Error("Не удаётся войти в интернет банк после ввода СМС-кода. Сайт изменен?");}b=createFormParams(a,null,!0);b=AnyBalance.requestPost(baseurl+"FWFServlet",b,addHeaders({Referer:AnyBalance.getLastUrl()}));if(!getParam(b,null,null,/<frame[^>]+name="mainframe"[^>]*src="([^"]*)/i,replaceHtmlEntities))throw AnyBalance.trace(b),new AnyBalance.Error("Не удалось войти в интернет банк на главную страницу. Сайт изменен?");AnyBalance.trace("Загружаем фреймсет...");for(var a=
sumParam(b,null,null,/<frame[^>]+src="([^"]*)/ig,replaceHtmlEntities),d=0;d<a.length;++d)b=AnyBalance.requestGet(joinUrl(baseurl,a[d]),addHeaders({Referer:baseurl+"FWFServlet"}));AnyBalance.trace("Получаем всё меню...");b=AnyBalance.requestGet(baseurl+"allmenuitems.jsp?session_lang=ru",g_headers);a=getSessionId(b);if(!a)throw AnyBalance.trace(b),new AnyBalance.Error("Не удалось получить меню после входа в интернет-банк. Сайт изменен?");if(/Срок действия Вашего пароля истек/i.test(b))throw new AnyBalance.Error("Банк сообщает, что срок действия Вашего пароля истек, Вам необходимо изменить пароль. Зайдите в интернет-банк через браузер, измените пароль и введите новый пароль в настройки провайдера.",
null,!0);}__setLoginSuccessful();return b}
function getMenuPage(c,b){var a=getParam(c,null,null,new RegExp("evaluate\\s*\\([^)]*"+b+"[^)]*"));if(!a)throw AnyBalance.trace(c),new AnyBalance.Error("Не удаётся найти ссылку на меню "+b+". Сайт изменен?");var d=getSessionId(c),e=getParam(a,null,null,/\(\s*'([^']*)/),f=getParam(a,null,null,/\((?:\s*[^,)]*,){2}\s*['"]?([^'",]*)/),a=getParam(a,null,null,/\((?:\s*[^,)]*,){3}\s*['"]?([^'",]*)/),d=getSessionId(c);return c=AnyBalance.requestPost(baseurl+"FWFServlet",{callType:"mpageCall",page:e,rights:"",
path:f,menuID:a,allItems:"true",session_id:d,lang:"ru"},addHeaders({Referer:baseurl+"allmenuitems.jsp?session_lang=ru"}))}function processInfo(c,b){if(AnyBalance.isAvailable("info")){var a=getSessionId(c);c=AnyBalance.requestPost(baseurl+"FWFServlet",{callType:"mpageCall",session_id:a,lang:"ru",USERGROUP:"br",TOPFRAME_CALLING:"true",page:""},addHeaders({Referer:baseurl+"FWFServlet"}));a=b.info={};getParam(c,a,"info.fio",/Здравствуйте,([^!<]*)/i,replaceTagsAndSpaces)}}
function processAccounts(c,b){if(AnyBalance.isAvailable("accounts")){c=getMenuPage(c,"Текущие счета");var a=getElement(c,/<tbody[^>]+scrollContent[^>]*>/i);a||(AnyBalance.trace(c),AnyBalance.trace("Не найдена таблица счетов"));b.accounts=[];a=getElements(a,/<tr[^>]*>/ig);if(a.length){AnyBalance.trace("Найдено счетов: "+a.length);for(var d=0;d<a.length;++d){var e=a[d],f=getParam(e,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),h=getParam(e,null,null,/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces)+" "+f.substr(-4),f={__id:f,__name:h,num:f};__shouldProcess("accounts",f)&&(c=processAccount(c,e,f));b.accounts.push(f)}}else AnyBalance.trace(c),AnyBalance.trace("Счета не найдены")}}
function createPropTable(c){var b=getElements(c,/<span[^>]+class\s*=\s*["']?base\b[^>]*>/ig);c=[];for(var a=0;a<b.length;++a){var d=b[a],e=/font-weight:bold|left:10px|left:355px/i.test(d)?-1:0,f=getParam(d,null,null,/top:\s*(\d+)px/i,replaceHtmlEntities,parseBalanceSilent),h=getParam(d,null,null,/left:\s*(\d+)px/i,replaceHtmlEntities,parseBalanceSilent),d=getParam(d,null,null,null,replaceTagsAndSpaces);c.push({title:e,vert:f,hor:h,text:d})}c.sort(function(a,c){var b=a.vert-c.vert;if(b||(b=a.hor-c.hor))return b});
for(var b=[],g,a=0;a<c.length;++a)d=c[a],d.title?(g&&b.push(g),g={title:d.text,text:""}):g&&(g.text+=(g.text?" ":"")+d.text);g&&b.push(g);return b}function performAction(c,b,a){var d=getElements(a,[/<(?:a|button)[^>]*populateForm[^>]*>/ig,c])[0];if(!d)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти действие: "+c.source);return performActionByString(d,b,a)}
function performActionByString(c,b,a){var d=getParam(c,null,null,/populateForm\w*\s*\(\s*'?([^',]*)/,replaceHtmlEntities);"this"==d&&(d=getParam(c,null,null,/name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities));var e=getParam(c,null,null,/populateForm\w*\s*\([^,)]*\s*,\s*'?([^',]*)/,replaceHtmlEntities);if(Array.isArray(b)){c="";for(var f=0;f<b.length;++f)c+=b[f].join(":")+"|";b=c}else if("object"==typeof b){c="";for(f in b)c+=f+":"+b[f]+"|";b=c}a=getElement(a,/<form[^>]+name="generic"[^>]*>/i);a=
createFormParams(a,function(a,c,f,l){return"params"==f?b:"triggeredbean"==f?d:"event"==f?e:l});return a=AnyBalance.requestPost(baseurl+"FWFServlet",a,addHeaders({Referer:baseurl+"FWFServlet"}))}
function processAccount(c,b,a){AnyBalance.trace("Обработка счета "+a.__name);getParam(b,a,"accounts.balance",/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,["accounts.currency","accounts.balance"],/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseCurrency);getParam(b,a,"accounts.name",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);if(AnyBalance.isAvailable("accounts.owner","accounts.date_start","accounts.transactions")){var d=
getParam(b,null,null,/<input[^>]+type=\s*['"]?radio[^>]*/i);b=getParam(d,null,null,/value\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities);b=getParam(d,null,null,/name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities)+":"+b+"|FRE$TabPage:0|0:true|";c=performActionByString(d,b,c);c=performAction(/Выписка по счету/i,b,c);for(var d=createPropTable(c),e=0;e<d.length;++e){var f=d[e];/Имя владельца/i.test(f.title)?getParam(f.text,a,"accounts.owner"):/Дата открытия счета/i.test(f.title)&&getParam(f.text,a,"accounts.date_start",
null,null,parseDate)}AnyBalance.isAvailable("accounts.transactions")&&(c=processAccountTransactions(c,a));c=performAction(/geri.gif/i,b,c)}return c}
function processCards(c,b){if(AnyBalance.isAvailable("cards")){c=getMenuPage(c,"Информация по Карте");var a=getElements(c,[/<div[^>]+class=['"]?base\b[^>]*>/ig,/Все карты, включая заблокированные/i])[0],d={FRE$TabPage:0};if(a){AnyBalance.trace("Включаем все карты.");var e=getParam(a,null,null,/name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities);d[e]="true";c=performActionByString(a,d,c)}a=getElements(c,[/<select[^>]*>/ig,/\d{6}\*{6}\d{4}/i])[0];a||(AnyBalance.trace(c),AnyBalance.trace("Не найдена таблица карт"));
e=getParam(a,null,null,/<select[^>]+name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities);b.cards=[];var f=sumParam(a,null,null,/<option[^>]*>[\s\S]*?(?:<\/option>|(?=<option)|(?=<\/select>))/ig);if(f.length){AnyBalance.trace("Найдено карт: "+(f.length-1));for(var h=0;h<f.length;++h){var g=f[h],k=getParam(g,null,null,/\bvalue="([^"]*)/i,replaceHtmlEntities);if(k){var l=getParam(g,null,null,/\d{6}\*{6}\d{4}/i,replaceTagsAndSpaces),g=getParam(g,null,null,null,replaceTagsAndSpaces),k={__id:k,__name:g,num:l};
__shouldProcess("cards",k)&&(d[e]=h,c=processCard(c,a,d,k));b.cards.push(k)}}}else AnyBalance.trace(c),AnyBalance.trace("Карты не найдены")}}
function processCard(c,b,a,d){AnyBalance.trace("Обработка карты "+d.__name);c=performActionByString(b,a,c);b=createPropTable(c);for(a=0;a<b.length;++a){var e=b[a];/Тип карты/i.test(e.title)&&getParam(e.text,d,"cards.type");/Тип продукта/i.test(e.title)?getParam(e.text,d,"cards.product_type"):/Имя владельца/i.test(e.title)?getParam(e.text,d,"cards.holder"):/Номер счета/i.test(e.title)?getParam(e.text,d,"cards.accnum"):/Валюта/i.test(e.title)?getParam(e.text,d,["cards.currency","cards.balance"]):/Статус Карты/i.test(e.title)?
getParam(e.text,d,"cards.status"):/действительна до/i.test(e.title)?getParam(e.text,d,"cards.till",null,null,parseDate):/Кредитный лимит/i.test(e.title)?getParam(e.text,d,"cards.limit",null,null,parseBalance):/Лимит для снятия наличными/i.test(e.title)?getParam(e.text,d,"cards.limit_cash",null,null,parseBalance):/Сумма доступных средств$/i.test(e.title)?(getParam(e.text,d,"cards.balance",null,null,parseBalance),getParam(e.text,d,"cards.available",null,null,parseBalance)):/Сумма доступных средств для снятия наличными/i.test(e.title)?
getParam(e.text,d,"cards.available_cash",null,null,parseBalance):/Собственные средства/i.test(e.title)?getParam(e.text,d,"cards.own",null,null,parseBalance):/Задолженность по выписке/i.test(e.title)?getParam(e.text,d,"cards.debt_previous",null,null,parseBalance):/Предварительный расчет задолженности на текущую дату/i.test(e.title)?getParam(e.text,d,"cards.debt",null,null,parseBalance):/Сумма накопленных баллов/i.test(e.title)&&getParam(e.text,d,"cards.bonus",null,null,parseBalance)}return c}
function processDeposits(c,b){AnyBalance.isAvailable("deposits")}
function processCredits(c,b){if(AnyBalance.isAvailable("credits")){c=getMenuPage(c,"Кредиты");var a=getElement(c,/<tbody[^>]+scrollContent[^>]*>/i);a||(AnyBalance.trace(c),AnyBalance.trace("Не найдена таблица кредитов"));b.credits=[];a=getElements(a,/<tr[^>]*>/ig);if(a.length){AnyBalance.trace("Найдено кредитов: "+a.length);for(var d=0;d<a.length;++d){var e=a[d],f=getParam(e,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),h=getParam(e,null,null,/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces)+" "+f.substr(-4),f={__id:f,__name:h,num:f};__shouldProcess("credits",f)&&(c=processCredit(c,e,f));b.credits.push(f)}}else AnyBalance.trace(c),AnyBalance.trace("Кредиты не найдены")}}function parseBool(c){return!/нет/i.test(c)}
function processCredit(c,b,a){AnyBalance.trace("Обработка кредита "+a.__name);getParam(b,a,"credits.balance",/(?:[\s\S]*?<td[^>]*>){14}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,["credits.currency","credits.balance"],/(?:[\s\S]*?<td[^>]*>){14}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseCurrency);getParam(b,a,"credits.limit",/(?:[\s\S]*?<td[^>]*>){12}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"credits.till",/(?:[\s\S]*?<td[^>]*>){10}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces,parseDate);getParam(b,a,"credits.date_start",/(?:[\s\S]*?<td[^>]*>){8}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate);getParam(b,a,"credits.status",/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,a,"credits.name",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);if(AnyBalance.isAvailable("credits.type","credits.accnum","credits.minpay_till","credits.shoud_pay_full","credits_pay_full","credits.schedule")){var d=getParam(b,null,null,
/<input[^>]+type=\s*['"]?radio[^>]*/i);b=getParam(d,null,null,/value\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities);b=getParam(d,null,null,/name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities)+":"+b+"|FRE$TabPage:0|0:true|";c=performActionByString(d,b,c);c=performAction(/Информация по кредиту/i,b,c);for(var d=createPropTable(c),e=0;e<d.length;++e){var f=d[e];/Тип Кредита/i.test(f.title)?getParam(f.text,a,"credits.type"):/^Счет$/i.test(f.title)?getParam(f.text,a,"credits.accnum"):/Дата очередного платежа/i.test(f.title)?
getParam(f.text,a,"credits.minpay_till",null,null,parseDate):/К досрочному погашению/i.test(f.title)?getParam(f.text,a,"credits.should_pay_full",null,null,parseBool):/Сумма полного досрочного погашения/i.test(f.title)&&getParam(f.text,a,"credits.pay_full",null,null,parseBalance)}AnyBalance.isAvailable("credits.schedule")&&(c=processCreditSchedule(c,a));c=performAction(/Назад/i,b,c)}return c};
