var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","User-Agent":"android-async-http/1.4.1 (http://loopj.com/android-async-http)"},g_appKey="afhgfgfdg56ujdj6rtymr67yjrt76tyherhdbryj6r46df57",g_registrationId="APA91bH8FeDpuVIxtiMvmG4Vxj1NksVvTlWtfR1a62aYLkZyiznaLWDzSrbW1xNVpT3LPvL8qSOuiej0UvGhOxswicz2",g_baseurl="https://napi.privatbank.ua/",g_login_hash="",g_imei="35374906******L",g_simsn="897010266********L",g_session="";
function requestJson(a,c,b){var d=[],e;for(e in a)d.push(encodeURIComponent(e)+"="+encodeURIComponent(a[e]));d.push(encodeURIComponent("cookie")+"="+encodeURIComponent(g_session));d.push(encodeURIComponent("simSN")+"="+encodeURIComponent(g_simsn));d.push(encodeURIComponent("imei")+"="+encodeURIComponent(g_login_hash));d.push(encodeURIComponent("appkey")+"="+encodeURIComponent(g_appKey));d.push(encodeURIComponent("language")+"=ru");d.push(encodeURIComponent("lon")+"=0.0");d.push(encodeURIComponent("device")+
"="+encodeURIComponent("SM-G900F|samsung"));d.push(encodeURIComponent("version")+"="+encodeURIComponent("5.11.02"));d.push(encodeURIComponent("versionOS")+"="+encodeURIComponent("5.0"));d.push(encodeURIComponent("lat")+"="+encodeURIComponent("0.0"));d.push(encodeURIComponent("ireal")+"="+encodeURIComponent(g_imei));a=g_baseurl+"iapi2/"+c+"?"+d.join("&");c=AnyBalance.requestGet(a,g_headers);c=getJson(c);if("ok"!=c.st&&(AnyBalance.trace("Error getting "+a+": "+JSON.stringify(c)),b))throw new AnyBalance.Error(b+
": "+(c.err||"").replace(/:\s[^&]&/,": "),null,/Неверный логин или пароль/i.test(c.err));return c}
function login(a,c){a=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");if(g_session){AnyBalance.trace("Найдена активная сессия, проверим её.");var b=requestJson({registration_id:g_registrationId},"props_full");"ok"!=b.st?(AnyBalance.trace("Сессия испорчена, будем заново авторизовываться"),g_session=""):AnyBalance.trace("Сессия действует, используем её.")}if(g_session)AnyBalance.trace();else{b=hex_md5(a.login);
AnyBalance.trace(b+" "+typeof b);g_login_hash=getParam(b,null,null,null,[/([\s\S]{8})([\s\S]{4})([\s\S]{4})([\s\S]{4})([\s\S]{12})/,"$1-$2-$3-$4-$5"]);AnyBalance.trace("Login imei param is: "+g_login_hash);g_imei=generateImei(a.login,g_imei);AnyBalance.trace("imei param is: "+g_imei);g_simsn=generateSimSN(a.login,g_simsn);AnyBalance.trace("simSN param is: "+g_simsn);b=requestJson({registration_id:g_registrationId},"props_full");if(/phone not linked to imei/i.test(b.err)){AnyBalance.trace("Устройство нужно привязать.");
requestJson({},"unlink_phone");b=requestJson({login:a.login},"auth_phone","Не удалось начать процесс привязки");b=b.id;requestJson({id:b,pass:a.password},"auth_pass","Не удалось зайти с паролем");var d=AnyBalance.retrieveCode("Пожалуйста, введите код из смс, для привязки данного устройства.",null,{time:3E5}),b=requestJson({id:b,otp:d},"auth_otp","Не удалось привязать устройство");g_session=b.cookie;AnyBalance.trace("Успешно привязали устройство.")}else AnyBalance.trace("Похоже что устройство уже привязано."),
b=requestJson({pass:a.password,bank:""},"chpass","Не удалось авторизоваться, проверьте логин и пароль."),g_session=b.cookie;__setLoginSuccessful()}if(!g_session)throw new AnyBalance.Error("Не удалось получить токен авторизации!");requestJson({},"banks");b=requestJson({registration_id:g_registrationId},"props_full");AnyBalance.isAvailable("info.mphone")&&(c.info={},getParam(b.phone,c.info,"info.mphone"));return b}
function processCards(a,c){if(AnyBalance.isAvailable("cards")){var b=a.cards;AnyBalance.trace("Найдено карт: "+b.length);c.cards=[];for(var d=0;d<b.length;++d){var e=b[d],f={__id:e.cardid,__name:e.alias+" "+e.number,num:e.number};__shouldProcess("cards",f)&&processCard(e,f);c.cards.push(f)}}}
function processCard(a,c,b){getParam(a.holded+"",c,"cards.balance",null,null,parseBalanceSilent);getParam(a.ccy,c,"cards.currency");getParam(a.is_nfc,c,"cards.is_nfc",null,null,parseBoolean);getParam(a.is_acc_foreign,c,"cards.is_foreign",null,null,parseBoolean);getParam(a.rate+"",c,"cards.pct",null,null,parseBalanceSilent);getParam(a.status,c,"cards.status");getParam(a.type,c,"cards.type");getParam(a.is_credit,c,"cards.is_credit");getParam(a.finlimit+"",c,"cards.limit",null,null,parseBalanceSilent);
getParam(a.min_pay+"",c,"cards.minpay",null,null,parseBalanceSilent);AnyBalance.isAvailable("cards.transactions")&&processCardTransactions(a,c)}function parseBoolean(a){return"1"==a}function findCardDetails(a,c){for(var b=0;b<c.length;b++){var d=c[b];if(a==d.cardid)return d}return null};
