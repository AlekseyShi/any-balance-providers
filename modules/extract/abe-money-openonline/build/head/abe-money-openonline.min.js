var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.360"},baseurl="https://online.openbank.ru/";
function getToken(d){return getParam(d,null,null,/name="__RequestVerificationToken"[^>]+value="([^"]+)/i)}
function login(){var d=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(d.login,"Введите логин!");checkEmpty(d.password,"Введите пароль!");var a=AnyBalance.requestGet(baseurl,g_headers);if(!a||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");if(/logOff/i.test(a))AnyBalance.trace("Уже залогинены, используем существующую сессию");else{var b=getElement(a,/<form[^>]+formAuth[^>]*>/i),
b=createFormParams(b,function(a,c,b,h){return"UserNameFromHidden"==b?d.login:"PasswordFromHidden"==b?d.password:h});if(/<input[^>]+id="captcha"[^>]*>/i.test(a)){var c=getParam(a,null,null,/<img[^>]+src="([^"]*)"[^>]+captcha[^>]*>/i);if(!c)throw new AnyBalance.Error("Не удалось найти ссылку на капчу. Сайт изменён?");c=AnyBalance.requestGet(baseurl+c,g_headers);b.captcha=AnyBalance.retrieveCode("Пожалуйста, введите код с картинки",c);b["captcha-guid"]=getParam(a,null,null,/<input[^>]+captcha-guid[^>]+value="([^"]*)/i)}a=
AnyBalance.requestPost(baseurl+"LogOn",b,addHeaders({Referer:baseurl+"logon"}))}if(!/logOff/i.test(a)){if(b=getParam(a,null,null,/<div[^>]+validator error[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(b,null,/(пароль неправильный|cимволы введены неверно)/i.test(b));AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}a=AnyBalance.requestGet(baseurl+"Finances/index",g_headers);__setLoginSuccessful();return a}
function processAccounts(d,a){if(AnyBalance.isAvailable("accounts")){var b=getParam(d,null,null,/<a[^>]*>Счета[\s\S]*?(<table[^>]+"info"[^>]*>[\s\S]*?<\/table>)/i),b=getElements(b,/<tr[^>]*>/ig);if(b.length){AnyBalance.trace("Найдено счетов: "+b.length);a.accounts=[];for(var c=0;c<b.length;c++){var e=getParam(b[c],null,null,/номер счета\s*([^<]*)/i),f=getParam(b[c],null,null,/номер счета\s*([^<]*)/i),g=getParam(b[c],null,null,/<span[^>]+name_card[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),e=
{__id:e,__name:g,num:f};__shouldProcess("accounts",e)&&processAccount(b[c],e);a.accounts.push(e)}}else AnyBalance.trace(d),AnyBalance.trace("Не удалось найти счета.")}}
function processAccount(d,a){AnyBalance.trace("Обработка счета "+a.__id);var b=getParam(d,null,null,/location\.href\s*=\s*['"]\/?([^'"]*)/i);if(b){var c=AnyBalance.requestGet(baseurl+b,g_headers);getParam(c,a,"accounts.incomingBalance",/Входящий остаток(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"accounts.blocked",/Заблокировано(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"accounts.balance",/<td[^>]*>\s*остаток(?:[^>]*>){2}([\s\S]*?)<\//i,
replaceTagsAndSpaces,parseBalance);getParam(c,a,"accounts.available",/доступно на(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(c,a,["accounts.currency","accounts.available","accounts.balance","accounts.incomingBalance","accounts.blocked"],/Входящий остаток(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseCurrency);AnyBalance.isAvailable("accounts.transactions")&&processAccountTransactions(b,a)}else AnyBalance.trace(d),AnyBalance.trace("Не удалось найти ссылку на выписку по счету"+
a.__id)}
function processCards(d,a){if(AnyBalance.isAvailable("cards")){var b=getElement(d,/<table[^>]+info cards-grid[^>]*>/i),b=getElements(b,/<tr[^>]*>/ig);if(b.length){AnyBalance.trace("Найдено карт: "+b.length);a.cards=[];for(var c=0;c<b.length;++c){var e=getParam(b[c],null,null,/<span[^>]+nomber_card[^>]*>[^]*(\d{4}[*\s]+\d{4})/i),f=getParam(b[c],null,null,/<span[^>]+nomber_card[^>]*>[^]*(\d{4}[*\s]+\d{4})/i,replaceTagsAndSpaces),g=getParam(b[c],null,null,/<a[^*>]*>([\s\S]*?)<\/a>/i,replaceTagsAndSpaces),e=
{__id:e,__name:g,num:f};__shouldProcess("cards",e)&&processCard(b[c],e);a.cards.push(e)}}else AnyBalance.trace(d),AnyBalance.trace("Не удалось найти карты.")}}
function processCard(d,a){AnyBalance.trace("Обработка карты "+a.__name);var b=getParam(d,null,null,/location\.href\s*=\s*['"]\/?([^'"]*)/i);if(b){var c=AnyBalance.requestGet(baseurl+b,g_headers);getParam(c,a,"cards.accnum",/Номер счета:(?:[^>]*>){4}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,a,"cards.till",/Карта действительна до:(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate);getParam(c,a,"cards.status",/Статус карты:(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,
a,"cards.balance",/Доступно на(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"cards.limit",/Кредитный лимит:(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"cards.debt",/Размер задолженности:(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"cards.accuredPct",/Начисленные проценты(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"cards.paySum",/Сумма очередного платежа(?:[^>]*>){2}([\s\S]*?)<\//i,
replaceTagsAndSpaces,parseBalance);getParam(c,a,"cards.blocked",/Заблокировано:(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"cards.overduePct",/штрафы(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"cards.currency cards.balance cards.limit cards.debt cards.oPCT cards.accuredPct cards.overduePct cards.paySum cards.blocked".split(" "),/Доступно на(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseCurrency);getParam(c,a,"cards.__tariff",
/Карточный тариф(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,a,"cards.payDate",/Дата следующего платежа(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate);isAvailable("cards.transactions")&&processCardTransactions(b,a)}else AnyBalance.trace(d),AnyBalance.trace("Не удалось найти ссылку на выписку по карте "+a.__id)}
function processDeposits(d,a){if(AnyBalance.isAvailable("deposits")){var b=getParam(d,null,null,/Вклады[\s\S]*?(<table[^>]+"info"[^>]*>[\s\S]*?<\/table>)/i),b=getElements(b,/<tr[^>]*>/ig);if(b.length){AnyBalance.trace("Найдено депозитов: "+b.length);a.deposits=[];for(var c=0;c<b.length;++c){var e=getParam(b[c],null,null,/<span[^>]+nomber_card[^>]*>[^\d]*(\d*)/i,replaceTagsAndSpaces),f=getParam(b[c],null,null,/<span[^>]+nomber_card[^>]*>[^\d]*(\d*)/i,replaceTagsAndSpaces),g=getParam(b[c],null,null,
/<span[^>]+name_card[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),e={__id:e,__name:g,num:f};__shouldProcess("deposits",e)&&processDeposit(b[c],e);a.deposits.push(e)}}else AnyBalance.trace(d),AnyBalance.trace("Не удалось найти вклады.")}}
function processDeposit(d,a){AnyBalance.trace("Обработка депозита "+a.__name);var b=getParam(d,null,null,/location\.href\s*=\s*['"]\/?([^'"]*)/i);if(b){var c=AnyBalance.requestGet(baseurl+b,g_headers);getParam(c,a,"deposits.balance",/остаток на(?:[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"deposits.pct",/Ставка:(?:[^>]*>){1}([^%]*)/i,replaceTagsAndSpaces,parseBalance);getParam(c,a,["deposits.currency","deposits.balance"],/остаток на(?:[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces,
parseCurrency);getParam(c,a,"deposits.accnum",/Номер счета(?:[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,a,"deposits.agreement",/Договор(?:[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,a,"deposits.status",/Статус(?:[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,a,"deposits.till",/остаток на(?:[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate);getParam(c,a,"deposits.date_start",/Дата открытия(?:[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate);
isAvailable("deposits.transactions")&&processDepositTransactions(b,a)}else AnyBalance.trace(d),AnyBalance.trace("Не удалось найти ссылку на выписку по депозиту"+a.__name)}function processCredits(d,a){throw new AnyBalance.Error("Обработка кредитов на данный момент не поддерживается. Пожалуйста, обратитесь к разработчику.");}function processInfo(d,a){var b=a.info={};getParam(d,b,"info.fio",/<div[^>]+hello([^>]*>){5}/i,replaceTagsAndSpaces)};
