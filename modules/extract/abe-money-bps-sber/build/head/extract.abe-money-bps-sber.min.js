var g_headers={Accept:"application/json","User-Agent":"OkHttp Headers.java","Content-Type":"text/xml;charset=UTF-8",Connection:"Keep-Alive"},baseurl="https://mobile.bps-sberbank.by:7001/",g_soapRequests={header:'<env:Header>\n    <n0:Security\n        xmlns:n0="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">\n        <n0:UsernameToken>\n            <n0:Username>%LOGIN%</n0:Username>\n            <n0:Password>%PASSWORD%</n0:Password>\n        </n0:UsernameToken>\n    </n0:Security>\n    <n1:DeviceUDID xmlns:n1="http://www.SoftClub.by/mobile">%DEVICEID%</n1:DeviceUDID>\n    <n2:ApplicID xmlns:n2="http://www.SoftClub.by/mobile">%VERSION%</n2:ApplicID>\n    <n3:lang xmlns:n3="http://www.SoftClub.by/mobile">ru</n3:lang>\n    <n4:clientKind xmlns:n4="http://www.SoftClub.by/mobile">0</n4:clientKind>\n</env:Header>',
accounts:{url:"by.softclub.services.mobile.sc.ifx.retail-1.0/AccountWS",body:'<env:Envelope xmlns:acc="http://www.softclub.by/neteller/account"\n    xmlns:env="http://schemas.xmlsoap.org/soap/envelope/">\n    %HEADER%\n    <env:Body>\n        <acc:getUserAccountsOverview>\n            <typeProductRequest>\n                <cardAccount />\n                <depoAccount />\n                <creditAccount />\n            </typeProductRequest>\n        </acc:getUserAccountsOverview>\n    </env:Body>\n</env:Envelope>',
action:"/by.softclub.services.mobile.sc.ifx.retail-1.0/AccountWS?wsdl"},login:{url:"ClientIdAndNameByLg-scws-context-root/GetClientIdAndNamePort",body:'<env:Envelope xmlns:cus="http://www.softclub.by/neteller/customer"\n    xmlns:env="http://schemas.xmlsoap.org/soap/envelope/">\n    %HEADER%\n    <env:Body>\n        <cus:User>\n            <cus:LOGIN_NAME>%LOGIN%</cus:LOGIN_NAME>\n            <cus:CLIENT_TYPE>0</cus:CLIENT_TYPE>\n        </cus:User>\n    </env:Body>\n</env:Envelope>',action:"GetClientIdAndNameBind/GetClientIdAndNameMethod"},
cardBalance:{url:"by.softclub.services.mobile.komplat.ex-1.0/KomplatWebServiceEx",body:'<?xml version="1.0" encoding="utf-8"?>\n<env:Envelope xmlns:env="http://schemas.xmlsoap.org/soap/envelope/">\n    %HEADER%\n    <env:Body>\n        <excuteRequestClobElement xmlns="http://komplat/KomplatWebService/srvs/types/">\n            <pRequest><![CDATA[<?xml version="1.0" encoding="Windows-1251" standalone="yes"?>\n                <BS_Request>\n                <Version>2070</Version>\n                <RequestType>Balance</RequestType>\n                <ClientId IdType="MS">%CARDHASH%</ClientId>\n                <AuthClientId IdType="MS">%CARDHASH%</AuthClientId>\n                <TerminalTime>%CURTIME%</TerminalTime>\n                <TerminalId>SCMOBILE</TerminalId>\n                <TerminalCapabilities>\n                <AnyAmount>Y</AnyAmount>\n\t\t <LongParameter>Y</LongParameter>\n                <ScreenWidth>99</ScreenWidth>\n                <CheckWidth DoubleHeightSymbol="Y" DoubleWidthSymbol="N" InverseSymbol="Y">40</CheckWidth>\n                </TerminalCapabilities>\n                <Balance Currency="%CURRENCY_NUM%">\n                \n\t\t<AuthorizationDetails Count="1">\n                <Parameter Idx="1" Name="Срок действия карточки"></Parameter>\n                </AuthorizationDetails>\n                </Balance>\n                </BS_Request>\n            ]]\x3e</pRequest>\n            <pSessionId />\n            <pSupplieroperid />\n            <pErrorCode_inout />\n            <pCardNumber />\n            <pCardExpDate />\n        </excuteRequestClobElement>\n    </env:Body>\n</env:Envelope>',
action:"http://SoftClub.by/DoIFX180"}};function makeRequest(a,c,b){b=b||g_soapRequests;a=b[a];b=a.body.replace(/%HEADER%/g,b.header);for(var d in c)b=b.replace(new RegExp("%"+d+"%","g"),(""+c[d]).replace("<","&lt;"));return AnyBalance.requestPost(baseurl+a.url,b,addHeaders({SOAPAction:a.action}))}var g_baseparams;
function login(){var a=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");g_baseparams={LOGIN:a.login,PASSWORD:a.password,DEVICEID:hex_md5(a.login).substr(0,16),VERSION:"v2.35"};var a=makeRequest("login",g_baseparams),c=getElement(a,/<(?:faultcode|errorcode)>/i,replaceTagsAndSpaces);if("0"!=c){var b=getElement(a,/<(?:faultstring|errortext)>/i,replaceTagsAndSpaces);if(b)throw new AnyBalance.Error(b,null,/парол|не зарегистрирован/i.test(b));
AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось зайти в интернет-банк (ошибка "+c+"). Сайт изменен?");}__setLoginSuccessful();return a}function getProducts(){getProducts.products||(getProducts.products=makeRequest("accounts",g_baseparams));return getProducts.products}
function processAccounts(a,c){if(AnyBalance.isAvailable("accounts")){a=getProducts();var b=getElement(a,/<cardAccounts>/i);if(b){b=getElements(b,/<cardAccount>/ig);AnyBalance.trace("Найдено "+b.length+" счетов");c.accounts=[];for(var d=0;d<b.length;++d){var e=b[d],f=getElement(e,/<accountId>/i,replaceTagsAndSpaces),h=getElement(e,/<additionalAccountId>/i,replaceTagsAndSpaces),g=getElement(e,/<depoAccountInfo[^>]*>/i),g=getElement(g,/<name>/i,replaceTagsAndSpaces),k=g+" "+h.substr(-4),f={__id:f,__name:k,
num:h,name:g};__shouldProcess("accounts",f)&&processAccount(e,f);c.accounts.push(f)}}else AnyBalance.trace(a),AnyBalance.trace("Не удалось найти карточные счета")}}
function requestCardBalance(a,c){var b=requestCardBalance.hashes||{};if(b[a])return b[a];var d=new Date,d=joinObjects(g_baseparams,{CARDHASH:a,CURRENCY_NUM:c,CURTIME:""+d.getFullYear()+n2(d.getMonth()+1)+n2(d.getDate())+n2(d.getHours())+n2(d.getMinutes())+n2(d.getSeconds())}),d=makeRequest("cardBalance",d),d=getElement(d,/<ns2:result>/i,replaceTagsAndSpaces);AnyBalance.trace("Got card response: "+d);b[a]=d;requestCardBalance.hashes=b;return d}
function processAccount(a,c){AnyBalance.trace("Обработка счета "+c.__name);getParam(a,c,"accounts.type",/<accountType>([\s\S]*?)<\/accountType>/i,replaceTagsAndSpaces);getParam(a,c,"accounts.status",/<status>([\s\S]*?)<\/status>/i,replaceTagsAndSpaces);getParam(a,c,["accounts.currency","accounts.balance"],/<currency>([\s\S]*?)<\/currency>/i,replaceTagsAndSpaces,CurrencyISO.digitsToLetters);getParam(a,c,"accounts.date_start",/<openDate>([\s\S]*?)<\/openDate>/i,replaceTagsAndSpaces,parseDateISO);getParam(a,
c,"accounts.pct",/<percentRate>([\s\S]*?)<\/percentRate>/i,replaceTagsAndSpaces,parseBalance);if(AnyBalance.isAvailable("accounts.balance")){var b=getElement(a,/<cardHash>/i,replaceTagsAndSpaces);if(b){var d=getElement(a,/<currency>/i,replaceTagsAndSpaces),b=requestCardBalance(b,d);getParam(b,c,"accounts.balance",/<Amount[^>]*>([\s\S]*?)<\/Amount>/i,replaceTagsAndSpaces,parseBalance)}else AnyBalance.trace("Счет не содержит карт, баланс недоступен")}}
function processCards(a,c){if(AnyBalance.isAvailable("cards")){a=getProducts();var b=getElement(a,/<cardAccounts>/i);if(b){b=getElements(b,/<cardAccount>/ig);AnyBalance.trace("Найдено "+b.length+" карточных счетов");c.cards=[];for(var d=0;d<b.length;++d){var e=b[d],f=getElement(e,/<accountId>/i,replaceTagsAndSpaces),h=getElement(e,/<additionalAccountId>/i,replaceTagsAndSpaces),g=getElements(e,/<card\b[^>]*>/ig);AnyBalance.trace("Счет "+h+" содержит "+g.length+" карт");for(var k=0;k<g.length;++k){var l=
g[k],m=getElement(l,/<cardHash>/i,replaceTagsAndSpaces),p=getElement(l,/<maskedCard>/i,replaceTagsAndSpaces),n=getElement(l,/<personalizedName>/i,replaceTagsAndSpaces);n||(n=getParam(l,null,null,/<cardType[^>]*name="([^"]*)/i,replaceHtmlEntities));var q=n+" "+p.substr(-4),m={__id:m,__name:q,num:p,accid:f,accnum:h,name:n};__shouldProcess("cards",m)&&processCard(l,m,e);c.cards.push(m)}}}else AnyBalance.trace(a),AnyBalance.trace("Не удалось найти карточные счета")}}
function processCard(a,c,b){AnyBalance.trace("Обработка карты "+c.__name);getParam(a,c,"cards.type",/<cardType[^>]*name="([^"]*)/i,replaceHtmlEntities);getParam(a,c,"cards.type_code",/<cardType[^>]*>([\s\S]*?)<\/cardType>/i,replaceTagsAndSpaces);getParam(a,c,"cards.status",/<status>([\s\S]*?)<\/status>/i,replaceTagsAndSpaces);getParam(a,c,"cards.till",/<exprireDate>([\s\S]*?)<\/exprireDate>/i,replaceTagsAndSpaces,parseDateISO);getParam(b,c,["cards.currency","cards.balance"],/<currency>([\s\S]*?)<\/currency>/i,
replaceTagsAndSpaces,CurrencyISO.digitsToLetters);AnyBalance.isAvailable("cards.balance")&&(b=getElement(b,/<currency>/i,replaceTagsAndSpaces),b=requestCardBalance(c.__id,b),getParam(b,c,"cards.balance",/<Amount[^>]*>([\s\S]*?)<\/Amount>/i,replaceTagsAndSpaces,parseBalance));isAvailable("cards.transactions")&&processCardTransactions(a,c)}function processDeposits(a,c){AnyBalance.isAvailable("deposits")}
function processDeposit(a,c,b){AnyBalance.trace("Обработка депозита "+c.__name);isAvailable("deposits.transactions")&&processDepositTransactions(a,c)}
function processCredits(a,c){if(AnyBalance.isAvailable("credits")){a=getProducts();var b=getElement(a,/<credits>/i);if(b){b=getElements(b,/<credit>/ig);AnyBalance.trace("Найдено "+b.length+" кредитов");c.credits=[];for(var d=0;d<b.length;++d){var e=b[d],f=getElement(e,/<contract_id>/i,replaceTagsAndSpaces),h=getElement(e,/<contractNumber>/i,replaceTagsAndSpaces),g=getElement(e,/<contract_name>/i,replaceTagsAndSpaces),k=g+" "+h.substr(-4),f={__id:f,__name:k,num:h,name:g};__shouldProcess("credits",
f)&&processCredit(e,f);c.credits.push(f)}}else AnyBalance.trace(a),AnyBalance.trace("Не удалось найти кредиты")}}
function processCredit(a,c){AnyBalance.trace("Обработка кредита "+c.__name);getParam(a,c,"credits.status",/<status>([\s\S]*?)<\/status>/i,replaceTagsAndSpaces);getParam(a,c,"credits.date_start",/<contract_date>([\s\S]*?)<\/contract_date>/i,replaceTagsAndSpaces,parseDateISO);getParam(a,c,"credits.till",/<contract_close_date>([\s\S]*?)<\/contract_close_date>/i,replaceTagsAndSpaces,parseDateISO);getParam(a,c,["credits.currency","credits.balance"],/<currency>([\s\S]*?)<\/currency>/i,replaceTagsAndSpaces,
CurrencyISO.digitsToLetters);getParam(a,c,"credits.balance",/<residualAmount>([\s\S]*?)<\/residualAmount>/i,replaceTagsAndSpaces,parseBalance);getParam(a,c,"credits.accid",/<relatedAccount>([\s\S]*?)<\/relatedAccount>/i,replaceTagsAndSpaces);getParam(a,c,"credits.limit",/<overdraftLimit>([\s\S]*?)<\/overdraftLimit>/i,replaceTagsAndSpaces,parseBalance);getParam(a,c,"credits.pct",/<percRate>([\s\S]*?)<\/percRate>/i,replaceTagsAndSpaces,parseBalance);AnyBalance.isAvailable("credits.transactions")&&processCreditTransactions(a,
c)}function processInfo(a,c){var b=c.info={};getParam(a,b,"info.fio",/<LAST_NAME>([\s\S]*?)<\/LAST_NAME>/i,replaceTagsAndSpaces);getParam(a,b,"info.passport",/<PASSPORT_NUMBER>([\s\S]*?)<\/PASSPORT_NUMBER>/i,replaceTagsAndSpaces);getParam(a,b,"info.paidup",/<PAID_UP>([\s\S]*?)<\/PAID_UP>/i,replaceTagsAndSpaces,parseBalance)};
