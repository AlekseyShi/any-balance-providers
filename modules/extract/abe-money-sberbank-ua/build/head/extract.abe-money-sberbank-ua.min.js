var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru,en-US;q=0.8,en;q=0.6,uk;q=0.4",Connection:"keep-alive",Origin:"https://online.oschadbank.ua","User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.111 Safari/537.36"},baseurl="https://online.oschadbank.ua/",gDataJson;
function login(a,b){AnyBalance.setDefaultCharset("utf-8");checkEmpty(a.login,"Введіть логін!");checkEmpty(a.password,"Введіть пароль!");AnyBalance.requestGet(baseurl+"wb/",g_headers);b=AnyBalance.requestGet(baseurl+"wb/api/v2/session",addHeaders({Referer:baseurl+"wb/","X-Requested-With":"XMLHttpRequest"}));var c=getJson(b);if("authenticated"!=c.status){if(b=AnyBalance.requestPost(baseurl+"wb/api/v2/session",JSON.stringify({login:a.login,password:a.password,captcha:"",_error:null}),addHeaders({Referer:baseurl+
"wb/","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"})),c=getJson(b),"authenticated"!=c.status){if(c._error)throw new AnyBalance.Error("INVALID_LOGIN_OR_PASSWORD"==c._error.code?"Невірний логін або пароль":c._error.code,null,/INVALID_LOGIN_OR_PASSWORD/i.test(c._error.code));if("confirmationRequired"==c._status)throw new AnyBalance.Error("Ощадбанк потребовал подтверждение входа по SMS. Эта возможность пока не поддерживается. Пожалуйста, обратитесь к разработчикам");AnyBalance.trace(b);
throw new AnyBalance.Error("Не удалось войти в интернет банк. Сайт изменен?");}}else AnyBalance.trace("Используем существующую сессию");__setLoginSuccessful();return c}function processProfile(a,b){a=getProductJson();for(var c=0;c<a.length;++c){var d=a[c];if(d.owner){b.profile={};getParam(d.owner.fullName,b.profile,"profile.fio");getParam(d.owner.itn,b.profile,"profile.itn");break}}}
function processCards(a,b){a=getProductJson("card");AnyBalance.trace("Найдено карт: "+a.length);b.cards=[];for(var c=0;c<a.length;++c){var d=a[c],e=d.number,e={__id:d.id,__name:e,num:e};__shouldProcess("cards",e)&&processCard(d,e);b.cards.push(e)}}
function processCard(a,b){getParam(a.balances.available.value,b,"cards.balance",null,null,parseBalance);getParam(a.balances.full_crlimit.value,b,"cards.maxlimit",null,null,parseBalance);getParam(a.card.expiryDate+"",b,"cards.till",null,null,parseDate);getParam(a.balances.total_due.value,b,"cards.debt",null,null,parseBalance);getParam(a.balances["06"].value,b,"cards.mz",null,null,parseBalance);getParam(a.card.accountNumber,b,"cards.rr");getParam(a.balances.available.currency,b,["cards.currency","cards.balance",
"cards.maxlimit","cards.debt","cards.mz"]);getParam(a.number,b,"cards.cardNumber");"undefined"!=typeof processCardTransactions&&processCardTransactions(a,b)}function processAccounts(a,b){a=getProductJson("cardAccount");AnyBalance.trace("Найдено счетов: "+a.length);b.accounts=[];for(var c=0;c<a.length;++c){var d=a[c],e=d.number,e={__id:d.id,__name:e,num:e};__shouldProcess("accounts",e)&&processAccount(d,e);b.accounts.push(e)}}
function processAccount(a,b){getParam(a.balances.available.value,b,"accounts.balance",null,null,parseBalance);getParam(a.balances.full_crlimit.value,b,"accounts.maxlimit",null,null,parseBalance);getParam(a.balances.total_due.value,b,"accounts.debt",null,null,parseBalance);getParam(a.balances["06"].value,b,"accounts.mz",null,null,parseBalance);getParam(a.cardAccount.accountNumber,b,"accounts.rr");getParam(a.balances.available.currency,b,["accounts.currency","accounts.balance","accounts.maxlimit","accounts.debt",
"accounts.mz"]);"undefined"!=typeof processAccountTransactions&&processAccountTransactions(a,b)}function getProductJson(a){if(gDataJson)b=gDataJson;else var b=AnyBalance.requestGet(baseurl+"wb/api/v2/contracts?system=W4C",addHeaders({"X-Requested-With":"XMLHttpRequest"})),b=gDataJson=getJson(b);return isset(a)?b.filter(function(b){return b.type==a}):b}function sortByKey(a,b){return a.sort(function(a,d){a=a[b];d=d[b];return a>d?-1:a<d?1:0})};
