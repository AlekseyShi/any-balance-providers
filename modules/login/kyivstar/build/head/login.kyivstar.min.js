var g_headers={"Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4","User-Agent":"Mozilla/5.0 (Windows NT 6.1; Intel Mac OS X 10.6; rv:7.0.1) Gecko/20100101 Firefox/7.0.1",Connection:"keep-alive"},g_gwtCfg={url:"https://account.kyivstar.ua/cas/auth/",strong_name:"\\b%VARNAME_BROWSER%],(\\w+)\\)",auth_nocache:"auth.nocache.js",magic_id:"703CC21949E0CA4038E6194B8CAEA98B"};function isLoggedIn(a){return/\/tbmb\/logout\/perform/i.test(a)}
function checkGwtError(a){try{return gwtGetJSON(a)}catch(d){if(/accountNotFound|AccountException/i.test(d.message))throw new AnyBalance.Error("Пользователь с таким логином не найден!",null,!0);throw d;}}function initializeLogin(){var a=AnyBalance.getPreferences();checkEmpty(a.login,"Введите номер вашего телефона для входа в Мой Киевстар (в формате +380ХХХХХХХХХ), например +380971234567");checkEmpty(a.password,"Введите пароль!");AnyBalance.setOptions({SSL_ENABLED_PROTOCOLS:["TLSv1"]})}
function isThereLoginForm(a){return getElement(a,/<form[^>]+id="auth-form"[^>]*>/i)}
function loginBasic(a){var d=AnyBalance.getPreferences(),c=AnyBalance.getLastUrl(),b=isThereLoginForm(a);if(!b)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти форму входа. Сайт изменен?");AnyBalance.trace("форма входа найдена");var e=gwtLoadStrongName(g_gwtCfg);a=AnyBalance.requestPost(g_gwtCfg.url+"authSupport.rpc",makeReplaces("7|0|6|%url%|%magic_id%|ua.kyivstar.cas.shared.rpc.AuthSupportRPCService|getAccountShortDetails|java.lang.String/2004016611|%LOGIN%|1|2|3|4|1|5|6|",g_gwtCfg).replace(/%LOGIN%/g,
gwtEscape(d.login)),gwtHeaders(e,g_gwtCfg));if(3<=checkGwtError(a)[10])throw new AnyBalance.Error("К сожалению, Киевстар потребовал ввода капчи для этого номера. Зайдите в личный кабинет один раз через браузер.",null,!0);var g={msisdn:"MSISDN_PASSWORD",fttb:"ACCOUNT_PASSWORD"},f=getParam(a,null,null,/"([^"]*)"\]/i,replaceSlashes);g[f]||(AnyBalance.trace("Неизвестный тип входа: "+f+"\n"+a),f="msisdn");a=AnyBalance.requestPost(g_gwtCfg.url+"authSupport.rpc",makeReplaces("7|0|8|%url%|%magic_id%|ua.kyivstar.cas.shared.rpc.AuthSupportRPCService|authenticate|java.lang.String/2004016611|Z|%LOGIN%|%PASSWORD%|1|2|3|4|4|5|5|5|6|7|8|0|0|",
g_gwtCfg).replace(/%LOGIN%/g,gwtEscape(d.login.replace(/\D+/g,""))).replace(/%PASSWORD%/g,gwtEscape(d.password)),gwtHeaders(e,g_gwtCfg));checkGwtError(a);var h=getParam(a,null,null,/AuthResult[^"]*","([^"]*)/,replaceSlashes);if(!h)throw new AnyBalance.Error("Персональный пароль указан неверно!",null,!0);a=AB.createFormParams(b,function(a,b,c,e){return"username"==c?d.login.replace(/\D+/g,""):"password"==c?d.password:"authenticationType"==c?g[f]:"rememberMe"==c?"false":"token"==c?h:e});b=getParam(b,
null,null,/<form[^>]+action="([^"]*)/i,replaceHtmlEntities);a=AnyBalance.requestPost(joinUrl(c,b),a,addHeaders({Referer:c}));c=getParam(c,null,null,/https?:\/\/[^\/]*/i);if(0===AnyBalance.getLastUrl().indexOf(c))throw AnyBalance.trace("Переадресовали на "+AnyBalance.getLastUrl()+":\n"+a),new AnyBalance.Error("Не удалось зайти в личный кабинет. Сайт изменен?");return a}
function loginSite(a){function d(){AnyBalance.trace("Пытаемся выйти...");var b=AnyBalance.requestGet(a+"tbmb/logout/perform.do",g_headers),c=getParam(b,null,null,/<a[^>]+id="submitBtn"[^>]*href="([^"]*)/i,replaceHtmlEntities);c&&(AnyBalance.trace("Переход на страницу входа."),b=AnyBalance.requestGet(c,g_headers));return b}var c=AnyBalance.getPreferences();initializeLogin();AnyBalance.trace("Логин на сайт.");AnyBalance.trace("Соединение с "+a);var b=AnyBalance.requestGet(a+"tbmb/disclaimer/show.do",
g_headers);if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),new AnyBalance.Error("Ошибка при подключении к сайту провайдера! Попробуйте обновить данные позже.");AnyBalance.trace("Успешное соединение.");isLoggedIn(b)&&(AnyBalance.trace("Уже в системе."),0>b.indexOf(c.login)&&(AnyBalance.trace("Не тот аккаунт, выход."),b=d()));isLoggedIn(b)||(isThereLoginForm(b)||(AnyBalance.trace(b),AnyBalance.trace("Не найдена форма входа. Выходим и явно переходим на авторизацию."),b=d(),AnyBalance.trace("Сейчас мы на "+
AnyBalance.getLastUrl()+". Переходим на авторизацию."),b=AnyBalance.requestGet("https://account.kyivstar.ua/cas/login?service=http%3A%2F%2Fmy.kyivstar.ua%3A80%2Ftbmb%2Fdisclaimer%2Fshow.do&locale=ua",g_headers)),b=loginBasic(b));if(!isLoggedIn(b)){if(c=getParam(b,null,null,/<td[^>]+class="(?:redError|casError)"[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(c,null,/Перевірте правильність введення логіну|введіть правильний пароль/i.test(c));if(/<form[^>]+action="[^"]*perform.do"/i.test(b))throw new AnyBalance.Error("Киевстар показал форму входа без ошибки. Возможно, вы пытаетесь войти в кабинет через мобильный интернет. На стороне Киевстара сейчас с этим проблема. Попробуйте обновить провайдер через вайфай.");
AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось зайти в систему. Сайт изменен?");}AnyBalance.trace("Успешный вход.");return b}
function loginMobile(a){initializeLogin();AnyBalance.trace("Логин в мобильное приложение.");a=AnyBalance.requestGet("https://account.kyivstar.ua/cas/login?locale=ru_ru&service=https://my.kyivstar.ua/tbmb/_assets_mobconv/portmone/index.html&renew=true&compact=1",g_headers);if(!a||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Ошибка при подключении к сайту провайдера! Попробуйте обновить данные позже.");AnyBalance.trace("Успешное соединение.");return a=loginBasic(a)}
;
