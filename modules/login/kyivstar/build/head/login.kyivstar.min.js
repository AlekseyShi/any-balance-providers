b;var g_headers={"Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4","User-Agent":"Mozilla/5.0 (Windows NT 6.1; Intel Mac OS X 10.6; rv:7.0.1) Gecko/20100101 Firefox/7.0.1",Connection:"keep-alive"},g_gwtCfg={url:"https://account.kyivstar.ua/cas/auth/",strong_name:"\\b%VARNAME_BROWSER%],(\\w+)\\)",auth_nocache:"auth.nocache.js",magic_id:"703CC21949E0CA4038E6194B8CAEA98B"};function isLoggedIn(a){return/\/tbmb\/logout\/perform/i.test(a)}
function checkGwtError(a){try{return gwtGetJSON(a)}catch(e){if(/accountNotFound|AccountException/i.test(e.message))throw new AnyBalance.Error("Пользователь с таким логином не найден!",null,!0);throw e;}}function initializeLogin(){var a=AnyBalance.getPreferences();checkEmpty(a.login,"Введите номер вашего телефона для входа в Мой Киевстар (в формате +380ХХХХХХХХХ), например +380971234567");checkEmpty(a.password,"Введите пароль!");AnyBalance.setOptions({SSL_ENABLED_PROTOCOLS:["TLSv1"]})}
function isThereLoginForm(a){return getElement(a,/<form[^>]+id="auth-form"[^>]*>/i)}
function loginBasic(a){var e=AnyBalance.getPreferences(),d=AnyBalance.getLastUrl(),c=isThereLoginForm(a);if(!c)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти форму входа. Сайт изменен?");AnyBalance.trace("форма входа найдена");var f=gwtLoadStrongName(g_gwtCfg);a=AnyBalance.requestPost(g_gwtCfg.url+"authSupport.rpc",makeReplaces("7|0|6|%url%|%magic_id%|ua.kyivstar.cas.shared.rpc.AuthSupportRPCService|getAccountShortDetails|java.lang.String/2004016611|%LOGIN%|1|2|3|4|1|5|6|",g_gwtCfg).replace(/%LOGIN%/g,
gwtEscape(e.login)),gwtHeaders(f,g_gwtCfg));if(3<=checkGwtError(a)[10])throw new AnyBalance.Error("К сожалению, Киевстар потребовал ввода капчи для этого номера. Зайдите в личный кабинет один раз через браузер.",null,!0);var h={msisdn:"MSISDN_PASSWORD",fttb:"ACCOUNT_PASSWORD"},g=getParam(a,null,null,/"([^"]*)"\]/i,replaceSlashes);h[g]||(AnyBalance.trace("Неизвестный тип входа: "+g+"\n"+a),g="msisdn");a=AnyBalance.requestPost(g_gwtCfg.url+"authSupport.rpc",makeReplaces("7|0|8|%url%|%magic_id%|ua.kyivstar.cas.shared.rpc.AuthSupportRPCService|authenticate|java.lang.String/2004016611|Z|%LOGIN%|%PASSWORD%|1|2|3|4|4|5|5|5|6|7|8|0|0|",
g_gwtCfg).replace(/%LOGIN%/g,gwtEscape(e.login.replace(/\D+/g,""))).replace(/%PASSWORD%/g,gwtEscape(e.password)),gwtHeaders(f,g_gwtCfg));checkGwtError(a);var k=getParam(a,null,null,/AuthResult[^"]*","([^"]*)/,replaceSlashes);if(!k)throw new AnyBalance.Error("Персональный пароль указан неверно!",null,!0);a=AB.createFormParams(c,function(a,c,d,f){return"username"==d?e.login.replace(/\D+/g,""):"password"==d?e.password:"authenticationType"==d?h[g]:"rememberMe"==d?"false":"token"==d?k:f});c=getParam(c,
null,null,/<form[^>]+action="([^"]*)/i,replaceHtmlEntities);a=AnyBalance.requestPost(joinUrl(d,c),a,addHeaders({Referer:d}));d=getParam(d,null,null,/https?:\/\/[^\/]*/i);if(0===AnyBalance.getLastUrl().indexOf(d))throw AnyBalance.trace("Переадресовали на "+AnyBalance.getLastUrl()+":\n"+a),new AnyBalance.Error("Не удалось зайти в личный кабинет. Сайт изменен?");return a}
function loginSite(a){function e(){AnyBalance.trace("Пытаемся выйти...");var c=AnyBalance.requestGet(a+"tbmb/logout/perform.do",g_headers),d=getParam(c,null,null,/<a[^>]+id="submitBtn"[^>]*href="([^"]*)/i,replaceHtmlEntities);d&&(AnyBalance.trace("Переход на страницу входа."),c=AnyBalance.requestGet(d,g_headers));return c}var d=AnyBalance.getPreferences();initializeLogin();AnyBalance.trace("Логин на сайт.");AnyBalance.trace("Соединение с "+a);var c=AnyBalance.requestGet(a+"tbmb/disclaimer/show.do",
g_headers);if(!c||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(c),new AnyBalance.Error("Ошибка при подключении к сайту провайдера! Попробуйте обновить данные позже.");AnyBalance.trace("Успешное соединение.");isLoggedIn(c)&&(AnyBalance.trace("Уже в системе."),0>c.indexOf(d.login)&&(AnyBalance.trace("Не тот аккаунт, выход."),c=e()));isLoggedIn(c)||(isThereLoginForm(c)||(AnyBalance.trace(c),AnyBalance.trace("Не найдена форма входа. Выходим и явно переходим на авторизацию."),c=e(),AnyBalance.trace("Сейчас мы на "+
AnyBalance.getLastUrl()+". Переходим на авторизацию."),c=AnyBalance.requestGet("https://account.kyivstar.ua/cas/login?service=http%3A%2F%2Fmy.kyivstar.ua%3A80%2Ftbmb%2Fdisclaimer%2Fshow.do&locale=ua",g_headers)),c=loginBasic(c));if(!isLoggedIn(c)){if(d=getParam(c,null,null,/<td[^>]+class="(?:redError|casError)"[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(d,null,/Перевірте правильність введення логіну|введіть правильний пароль/i.test(d));if(/<form[^>]+action="[^"]*perform.do"/i.test(c))throw new AnyBalance.Error("Киевстар показал форму входа без ошибки. Возможно, вы пытаетесь войти в кабинет через мобильный интернет. На стороне Киевстара сейчас с этим проблема. Попробуйте обновить провайдер через вайфай.");
AnyBalance.trace(c);throw new AnyBalance.Error("Не удалось зайти в систему. Сайт изменен?");}AnyBalance.trace("Успешный вход.");return c}
function loginMobile(a){initializeLogin();AnyBalance.trace("Логин в мобильное приложение.");a=AnyBalance.requestGet("https://account.kyivstar.ua/cas/login?locale=ru_ru&service=https://my.kyivstar.ua/tbmb/_assets_mobconv/portmone/index.html&renew=true&compact=1",g_headers);if(!a||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Ошибка при подключении к сайту провайдера! Попробуйте обновить данные позже.");AnyBalance.trace("Успешное соединение.");return a=loginBasic(a)}
;
